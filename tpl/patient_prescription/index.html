<div ng-controller="PrescriptionController">
    <div class="hbox hbox-auto-xs hbox-auto-sm">
        <!-- CURRENT -->
        <div class="col">
            <div class="bg-light lter b-b wrapper-md" style="width:100%;float:left; padding:10px; padding-bottom:0px; margin-bottom:15px;">
                <div class="col-sm-3 m-b-xs">
                    <h1 class="m-n h3">Prescription</h1>
                </div>
                <div class="col-sm-3 m-b-xs pull-right right" ng-if="all_encounters.length == 1">
                    <b> Encounter ID : </b> {{enc.selected.encounter_id}}
                    <b> Date : </b> {{enc.selected.encounter_date}}
                </div>
                <div class="col-sm-4 m-b-xs pull-right right" ng-if="all_encounters.length > 1">
                    <b style="float: left;"> Encounter ID : </b>
                    <select style="width: 20%; float: left; margin-right: 10px" class="form-control" ng-model="data.encounter_id" ng-options="all_encounter.encounter_id as all_encounter.encounter_id for all_encounter in all_encounters| orderBy: encounter_id">
                    </select>
                    <b> Date : </b> {{enc.selected.encounter_date}}
                </div>
            </div>
            <div class="wrapper-md p-b prescription-new">
                <div class="row">
                    <div class="col-sm-12" ng-init="tab = 1">
                        <div class="tab-container">
                            <ul class="nav nav-tabs">
                                <li ng-show="(prescription_tab.PTP == 1)" ng-class="{active:tab == 1}">
                                    <a href ng-click="Setempty_tab(); tab = 1">
                                        <tab-heading > 
                                            <i class="fa fa-medkit" aria-hidden="true"></i> Prescription
                                        </tab-heading>
                                    </a>
                                </li>
                                <li ng-show="(prescription_tab.PTM == 1)" ng-class="{active:tab == 2}">
                                    <a href ng-click="Setempty_tab(); loadmedicalcasehistory(); tab = 2">
                                        <tab-heading > 
                                            <i class="fa fa-history" aria-hidden="true"></i> 
                                            Medical Case History
                                        </tab-heading>
                                    </a>
                                </li>
                                <li ng-show="(prescription_tab.PTV == 1)" ng-class="{active:tab == 3}">
                                    <a href ng-click="Setempty_tab(); loadVitals(); seen_vitals_left_notification(); tab = 3">
                                        <tab-heading> 
                                            <i class="fa fa-heartbeat" aria-hidden="true"></i> 
                                            Vitals <span class="badge bg-success badge-sm m-l-xs" ng-show="app.patientDetail.patientUnseenVitalsCount > 0">
                                                {{app.patientDetail.patientUnseenVitalsCount}} New
                                            </span> 
                                        </tab-heading>
                                    </a>
                                </li>
                                <li ng-show="(prescription_tab.PTR == 1)" ng-class="{active:tab == 4}">
                                    <a href ng-click="Setempty_tab(); initResultForm(); tab = 4">
                                        <tab-heading> 
                                            <i class="fa fa-file-text" aria-hidden="true"></i> Results 
                                        </tab-heading>
                                    </a>
                                </li>
                                <li ng-show="(prescription_tab.PTN == 1)" ng-class="{active:tab == 5}">
                                    <a href ng-click="Setempty_tab(); initConsultantForm(); tab = 5">
                                        <tab-heading> 
                                            <i class="fa fa-pencil" aria-hidden="true"></i> Consultant Notes
                                        </tab-heading>
                                    </a>
                                </li>

                                <li class="ng-scope">
                                    <a href>
                                        <script type="text/ng-template" id="PrescriptionTabModalContent.html">
                                            <div ng-include="'tpl/modal_form/modal.prescription_tab_setting.html'"></div>
                                        </script>
                                        <i class="fa fa-plus" aria-hidden="true" ng-click="openTabsetting('md', 'PrescriptiontabModalInstanceCtrl', 'PrescriptionTabModalContent.html', '')"></i>
                                    </a>
                                </li>
                            </ul>

                            <div class="tab-content">
                                <div ng-show="tab == 1">
                                    <div ng-include="'tpl/blocks/alert.html'">
                                        {% include 'tpl/blocks/alert.html' %}
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <select class="form-control" ng-show="pres_status == 'current'" ng-model="data.consultant_id" ng-options="doctor.user_id as doctor.fullname for doctor in doctors| orderBy: 'name'" ng-change="getConsultantFreq()">
                                                <option value="">Select Consultant</option>
                                            </select>
                                        </div>
                                        <div class="col-sm-4">
                                            <input autocomplete="off"
                                                   placeholder="Diagnosis"
                                                   type="text"
                                                   class="form-control"
                                                   id="diagnosis"
                                                   ng-model="diagnosis"
                                                   typeahead="Diag as diagname_desc(Diag) for Diag in getdiagnosis($viewValue) | orderBy: bill_no"
                                                   typeahead-on-select="setDiagid($item)"
                                                   typeahead-wait-ms="400" ng-show="pres_status == 'current'"
                                                   />
                                        </div>
                                        <div class="col-sm-3">
                                            <div ng-show="pres_status == 'current'">
                                                <label class="i-switch m-t-xs m-r"> 
                                                    <input type="checkbox" checked="" ng-true-value="'1'" ng-false-value="'0'" name="status" ng-model="available_medicine" ng-change='checkAvailable(available_medicine)'> 
                                                    <i></i>
                                                </label>Show only available medicines
                                            </div>
                                        </div>
                                        <div class="col-sm-2 pres-tab-btn-cont1">
                                            <button tooltip="Back" ng-show="pres_status != 'current'" ng-click="pres_status = 'current'" class="btn btn-default btn-dark"><i class="fa fa-arrow-left"></i></button>
                                            <button tooltip="Previous Prescription" tooltip-placement="left" ng-show="pres_status != 'prev'" ng-click="pres_status = 'prev'" class="btn btn-default btn-primary"><i class="fa fa-history"></i> </button>
                                            <button tooltip="Favourite" ng-click="pres_status = 'favourite'" ng-show="pres_status != 'favourite'" class="btn btn-default btn-primary"><i class="fa fa-heart"></i> </button>
                                        </div>
                                    </div>

                                    <div ng-show="pres_status == 'current'">
                                        <div class="row wrapper pb-sm">

                                            <div class="prescription-hightlight">

                                                <table  class="table table-striped b-t b-light">
                                                    <thead>
                                                        <tr>
                                                            <th  align="left" class="pres-top-pro" valign="top" >Products 
                                                                <span ng-show="show_prescription_loader">&nbsp;&nbsp;
                                                                    <i class="fa fa-spin fa-refresh"></i>
                                                                </span>
                                                            </th>
                                                            <th  align="left" class="pres-top-freq" valign="top" >Frequency</th>
                                                            <th align="left" class="pres-top-qty" valign="top">No.Of Days</th>
                                                            <th  align="left" class="pres-top-remarks" valign="top">Remarks</th>
                                                            <th  align="left" class="pres-top-actions" valign="top">Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr style="background:none;">
                                                            <td align="left" valign="top">
                                                                <div class="top-product-search"  >
                                                                    <div class="input-group">
                                                                        <input type="text"
                                                                               id="prescription_global_search"
                                                                               class="form-control prescription_search_input" 
                                                                               placeholder="Enter Your Prescription" 
                                                                               select-on-click=""
                                                                               ng-model='prescription'
                                                                               />

                                                                        <div class="patient-search-result" ng-if="prescription != '' && prescription_lists" >
                                                                            <ul class="search-patientcont-header" id='prescriptioncont-header' ng-show="prescription_lists.length > 0">
                                                                                <!--                                                                            <li ng-repeat="(key, prescription_list) in prescription_lists" class="{{prescription_list.selected}}" ng-click="addGlobalSearch(prescription_list)">-->
                                                                                <li ng-repeat="(key, prescription_list) in prescription_lists" class="{{prescription_list.selected}}" ng-click="pick(prescription_list)">
                                                                                    <a data-key="{{key}}" ng-bind-html="prescription_list.prescription | highlight:prescription" href="javascript:void(0)" class="ng-binding {{(prescription_list.available_quantity <= 0 && presc_stock_status==1) ? 'text-danger' : ''}}"></a>
                                                                                </li>
                                                                            </ul>
                                                                        </div>

                                                                        <div dropdown="" class="input-group-btn dropdown" ng-init="initForm()" id="search-form">
                                                                            <button dropdown-toggle="" class="btn btn-default" type="button" aria-haspopup="true" aria-expanded="false"><span class="caret"></span></button>
                                                                            <div class="dropdown-menu pull-right   prescrip-dropdown2">
                                                                                <form id="advanceSearchForm" name="searchForm" class="form-horizontal form-validation" novalidate="">
                                                                                    <div class="panel panel-default">
                                                                                        <div class="panel-heading font-bold"> <i class="fa fa-medkit"></i> Search & Add</div>
                                                                                        <div class="panel-body">
                                                                                            <div class="row">
                                                                                                <div class="form-group"> 

                                                                                                    <div class="col-sm-3">
                                                                                                        <label>Drug Class</label>
                                                                                                        <input autocomplete="off"
                                                                                                               placeholder="Drug Class"
                                                                                                               type="text"
                                                                                                               class="form-control"
                                                                                                               name = "DrugClass"
                                                                                                               ng-model="addData.drug_class"
                                                                                                               ng-change = "watchDrug(true, this)"
                                                                                                               typeahead-editable="true"
                                                                                                               typeahead="drug as drug.drug_name for drug in drugs | filter:$viewValue"
                                                                                                               typeahead-on-select="getGeneric($item, $model, $label)" />
                                                                                                    </div>
                                                                                                    <div class="col-sm-3">
                                                                                                        <label> Generic </label>
                                                                                                        <select ng-show="generics.length > 0" class="form-control" name="Generic" ng-model="addData.generic" ng-options="generic as generic.generic_name for generic in generics| filter:$viewValue" data-ng-change="getProduct(false, null, null)">
                                                                                                            <option value="">Select Generic</option>
                                                                                                        </select>
                                                                                                        <input autocomplete="off"
                                                                                                               placeholder="Generic"
                                                                                                               type="text"
                                                                                                               class="form-control"
                                                                                                               ng-model="addData.generic"
                                                                                                               ng-hide="generics.length > 0"
                                                                                                               typeahead-editable="false"
                                                                                                               typeahead-min-length='2'
                                                                                                               typeahead="generic as generic.generic_name for generic in allgenerics | filter:$viewValue"
                                                                                                               typeahead-on-select="getDrugProduct($item, $model, $label)" />
                                                                                                    </div>
                                                                                                    <div class="col-sm-3">
                                                                                                        <label> Product</label>
                                                                                                        <select class="form-control" name="Product" ng-model="addData.product" ng-options="product as product.full_name for product in products| filter:$viewValue" data-ng-change="setGeneric();
                                                                                                            getRoutes(false, null, null)">
                                                                                                            <option value="">Select Product</option>
                                                                                                        </select>                                                                    
                                                                                                    </div>
                                                                                                    <div class="col-sm-3 freq_3_times_adv_form">
                                                                                                        <label> Freq</label>
                                                                                                        <div class="clearfix"></div>
                                                                                                        <input autocomplete="off" 
                                                                                                               type="text" 
                                                                                                               name="masked" 
                                                                                                               id='frequency_3_0'
                                                                                                               ng-model="addData.frequency_3_0" 
                                                                                                               model-view-value="true" 
                                                                                                               class="form-control m-b"
                                                                                                               number-mask=""
                                                                                                               maxlength="4"
                                                                                                               required>
                                                                                                        <input autocomplete="off" 
                                                                                                               type="text" 
                                                                                                               name="masked" 
                                                                                                               ng-model="addData.frequency_3_1" 
                                                                                                               model-view-value="true" 
                                                                                                               class="form-control m-b"
                                                                                                               number-mask=""
                                                                                                               maxlength="4"
                                                                                                               required>
                                                                                                        <input autocomplete="off" 
                                                                                                               type="text" 
                                                                                                               name="masked" 
                                                                                                               ng-model="addData.frequency_3_2" 
                                                                                                               model-view-value="true" 
                                                                                                               class="form-control m-b"
                                                                                                               number-mask=""
                                                                                                               maxlength="4"
                                                                                                               required>
                                                                                                    </div>
                                                                                                </div>

                                                                                                <div class="form-group">

                                                                                                    <div class="col-sm-3">
                                                                                                        <label> Route </label>
                                                                                                        <select class="form-control" name="Route" ng-model="addData.route" ng-options="route as route.route_name for route in routes| filter:$viewValue">
                                                                                                            <option value="">Select Route</option>
                                                                                                        </select>
                                                                                                    </div>
                                                                                                    <div class="col-sm-3">
                                                                                                        <label>No.of.Days </label>
                                                                                                        <input autocomplete="off" type="text" ng-model="addData.number_of_days" class="form-control m-b" number-mask="">
                                                                                                    </div>

                                                                                                    <div class="col-sm-3">
                                                                                                        <label> </label>
                                                                                                        <br/>
                                                                                                        <button class="btn m-b-xs  btn-success save-btn" 
                                                                                                                ng-disabled="!addData.number_of_days || !addData.route || !addData.frequency_3_2 || !addData.frequency_3_1 || !addData.frequency_3_0 || !addData.product || !addData.drug_class || !addData.generic"
                                                                                                                ng-click="addForm()"><i class="fa fa-plus"></i> Add</button>
                                                                                                        &nbsp;
                                                                                                    </div>
                                                                                                    <div class="col-sm-3">
                                                                                                        <label> </label>
                                                                                                        <br/>
                                                                                                        <button class="btn m-b-xs  btn-dark" ng-click="reset()"> <i class="fa fa-repeat"></i> Reset</button>
                                                                                                        &nbsp;
                                                                                                    </div>

                                                                                                </div>


                                                                                                <div class="form-group"> 

                                                                                                    <div class="col-sm-12"> 
                                                                                                        <script type="text/ng-template" id="ProductModalContent.html">
                                                                                                            <div ng-include="'tpl/modal_form/modal.product.html'"></div>
                                                                                                        </script>
                                                                                                        <button type="button" class="btn m-b-xs btn-primary" ng-click="openModel('lg', 'ProductModalInstanceCtrl', 'ProductModalContent.html', '')">
                                                                                                            <i class="fa fa-plus text ng-scope"></i> Add Medicine
                                                                                                        </button>

                                                                                                    </div>



                                                                                                </div>


                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </form>
                                                                            </div>
                                                                        </div>
                                                                        <!-- /btn-group --> 
                                                                    </div>
                                                                </div>
                                                            </td>
                                                            <td align="left" valign="top">
                                                                <div class="pre-freq-new1" id="globalDataFreq">
                                                                    <div id="frequency_3" ng-show="globalData.freq_type == '3'">
                                                                        <!--ng-keyup="$event.keyCode == 13 ? addGlobalForm() : null"-->
                                                                        <input type="text"
                                                                               autocomplete="off" 
                                                                               ng-model="globalData.frequency_3_0"
                                                                               class="form-control text-center"
                                                                               number-mask
                                                                               maxlength="4"
                                                                               auto-complete
                                                                               ac-options="autoCompleteOptions_3_0"
                                                                               ng-keyup="$event.keyCode == 13 ? addGlobalForm() : null"
                                                                               />
                                                                        <input type="text"
                                                                               autocomplete="off" 
                                                                               ng-model="globalData.frequency_3_1"
                                                                               class="form-control text-center"
                                                                               number-mask
                                                                               maxlength="4"
                                                                               auto-complete
                                                                               ac-options="autoCompleteOptions_3_1"
                                                                               ng-keyup="$event.keyCode == 13 ? addGlobalForm() : null"
                                                                               />
                                                                        <input type="text"
                                                                               autocomplete="off" 
                                                                               ng-model="globalData.frequency_3_2"
                                                                               class="form-control text-center"
                                                                               number-mask
                                                                               maxlength="4"
                                                                               auto-complete
                                                                               ac-options="autoCompleteOptions_3_2"
                                                                               ng-keyup="$event.keyCode == 13 ? addGlobalForm() : null"
                                                                               />
                                                                    </div>
                                                                    <div id="frequency_4" ng-show="globalData.freq_type == '4'">
                                                                        <input type="text"
                                                                               autocomplete="off" 
                                                                               ng-model="globalData.frequency_4_0"
                                                                               class="form-control text-center"
                                                                               number-mask
                                                                               maxlength="4"
                                                                               auto-complete
                                                                               ac-options="autoCompleteOptions_4_0"
                                                                               ng-keyup="$event.keyCode == 13 ? addGlobalForm() : null"
                                                                               />
                                                                        <input type="text"
                                                                               autocomplete="off" 
                                                                               ng-model="globalData.frequency_4_1"
                                                                               class="form-control text-center"
                                                                               number-mask
                                                                               maxlength="4"
                                                                               auto-complete
                                                                               ac-options="autoCompleteOptions_4_1"
                                                                               ng-keyup="$event.keyCode == 13 ? addGlobalForm() : null"
                                                                               />
                                                                        <input type="text"
                                                                               autocomplete="off" 
                                                                               ng-model="globalData.frequency_4_2"
                                                                               class="form-control text-center"
                                                                               number-mask
                                                                               maxlength="4"
                                                                               auto-complete
                                                                               ac-options="autoCompleteOptions_4_2"
                                                                               ng-keyup="$event.keyCode == 13 ? addGlobalForm() : null"
                                                                               />
                                                                        <input type="text"
                                                                               autocomplete="off" 
                                                                               ng-model="globalData.frequency_4_3"
                                                                               class="form-control text-center"
                                                                               number-mask
                                                                               maxlength="4"
                                                                               auto-complete
                                                                               ac-options="autoCompleteOptions_4_3"
                                                                               ng-keyup="$event.keyCode == 13 ? addGlobalForm() : null"
                                                                               />
                                                                    </div>
                                                                    <div id="frequency_txt" ng-show="globalData.freq_type == 'txt'">
                                                                        <input autocomplete="off" 
                                                                               ng-keyup="$event.keyCode == 13 ? addGlobalForm() : null"
                                                                               type="text" 
                                                                               name="masked" 
                                                                               ng-model="globalData.frequency_txt" 
                                                                               model-view-value="true" 
                                                                               class="form-control"
                                                                               ng-keyup="$event.keyCode == 13 ? addGlobalForm() : null" >
                                                                    </div>

                                                                    <div style="width: 20px; float:left">
                                                                        <div class="input-group-btn dropdown">
                                                                            <button tabindex="-1" class="btn btn-default dropdown-toggle" ng-click="checkProducttype(item.description_name)" type="button" data-toggle="dropdown">
                                                                                <span class="fa fa-ellipsis-v"></span>
                                                                            </button>
                                                                            <ul class="dropdown-menu curPrescFreq">
                                                                                <!--                                                                                Mask 3 -->
                                                                                <li ng-repeat="consFreq in currPresMask3| limitTo:3">
                                                                                    <div class="row">
                                                                                        <div class="col-sm-12">
                                                                                            <a href ng-click="TopFreqSele(consFreq.freq_name, consFreq.freq_type)" class="col-sm-9">{{consFreq.freq_name}}</a>
                                                                                            <a class="col-sm-3" title='Clear' ng-click="clearCache(consFreq.freq_id)">X</a>
                                                                                        </div>
                                                                                    </div>
                                                                                </li>
                                                                                <li class="dropdown-submenu" ng-if="currPresMask3.length > 3">
                                                                                    <a tabindex="-1" href="#">More</a>
                                                                                    <ul class="dropdown-menu">
                                                                                        <li ng-repeat="consFreq in currPresMask3| limitTo:(3 - currPresMask3.length)">
                                                                                            <div class="row">
                                                                                                <div class="col-sm-12">
                                                                                                    <a href ng-click="TopFreqSele(consFreq.freq_name, consFreq.freq_type)" class="col-sm-9">{{consFreq.freq_name}}</a>
                                                                                                    <a class="col-sm-3" title='Clear' ng-click="clearCache(consFreq.freq_id)">X</a>
                                                                                                </div>
                                                                                            </div>
                                                                                        </li>
                                                                                    </ul>
                                                                                </li>
                                                                                <li class="divider"></li>
                                                                                <!--                                                                                Mask 4 -->
                                                                                <li ng-repeat="consFreq in currPresMask4| limitTo:3">
                                                                                    <div class="row">
                                                                                        <div class="col-sm-12">
                                                                                            <a href ng-click="TopFreqSele(consFreq.freq_name, consFreq.freq_type)" class="col-sm-9">{{consFreq.freq_name}}</a>
                                                                                            <a class="col-sm-3" title='Clear' ng-click="clearCache(consFreq.freq_id)">X</a>
                                                                                        </div>
                                                                                    </div>
                                                                                </li>
                                                                                <li class="dropdown-submenu" ng-if="currPresMask4.length > 3">
                                                                                    <a tabindex="-1" href="#">More</a>
                                                                                    <ul class="dropdown-menu">
                                                                                        <li ng-repeat="consFreq in currPresMask4| limitTo:(3 - currPresMask4.length)">
                                                                                            <div class="row">
                                                                                                <div class="col-sm-12">
                                                                                                    <a href ng-click="TopFreqSele(consFreq.freq_name, consFreq.freq_type)" class="col-sm-9">{{consFreq.freq_name}}</a>
                                                                                                    <a class="col-sm-3" title='Clear' ng-click="clearCache(consFreq.freq_id)">X</a>
                                                                                                </div>
                                                                                            </div>
                                                                                        </li>
                                                                                    </ul>
                                                                                </li>
                                                                                <li class="divider"></li>
                                                                                <!--                                                                                Mask Txt -->
                                                                                <li ng-repeat="consFreq in currPresMaskTxt| limitTo:3">
                                                                                    <div class="row">
                                                                                        <div class="col-sm-12">
                                                                                            <a href ng-click="TopFreqSele(consFreq.freq_name, consFreq.freq_type)" class="col-sm-9">{{consFreq.freq_name}}</a>
                                                                                            <a class="col-sm-3" title='Clear' ng-click="clearCache(consFreq.freq_id)">X</a>
                                                                                        </div>
                                                                                    </div>
                                                                                </li>
                                                                                <li class="dropdown-submenu" ng-if="currPresMaskTxt.length > 3">
                                                                                    <a tabindex="-1" href="#">More</a>
                                                                                    <ul class="dropdown-menu">
                                                                                        <li ng-repeat="consFreq in currPresMaskTxt| limitTo:(3 - currPresMaskTxt.length)">
                                                                                            <div class="row">
                                                                                                <div class="col-sm-12">
                                                                                                    <a href ng-click="TopFreqSele(consFreq.freq_name, consFreq.freq_type)" class="col-sm-9">{{consFreq.freq_name}}</a>
                                                                                                    <a class="col-sm-3" title='Clear' ng-click="clearCache(consFreq.freq_id)">X</a>
                                                                                                </div>
                                                                                            </div>
                                                                                        </li>
                                                                                    </ul>
                                                                                </li>
                                                                            </ul>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </td>
                                                            <td align="left" valign="top">
                                                                <input type="text"
                                                                       autocomplete="off" 
                                                                       ng-model="globalData.no_of_days" 
                                                                       class="form-control text-center"
                                                                       drop-disable 
                                                                       number-mask
                                                                       maxlength="4"
                                                                       auto-complete
                                                                       ac-options="autoCompleteOptionsNoofdays"
                                                                       ng-keyup="$event.keyCode == 13 ? addGlobalForm() : null"
                                                                       />
                                                            </td>
                                                            <td align="left" valign="top"><input id="ps_remarks" name="" ng-keyup="$event.keyCode == 13 ? addGlobalForm() : null" ng-model="globalData.remarks" type="text"  class="form-control"></td>
                                                            <td align="left" valign="top" style="width:100px;" class="top-prescription-buttons">
                                                                <button class="btn m-b-xs  btn-success" ng-click="addGlobalForm()"><i class="fa fa-plus" aria-hidden="true"></i></button>
                                                                <button class="btn m-b-xs  btn-dark" ng-click="resetGlobalForm()"><i class="fa fa-times"></i></button>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="in-patient-table pres-table">
                                            <div class=" p-b">

                                                <div class="row">
                                                    <form editable-form name="tableform" name="prescForm" class="form-horizontal form-validation curPresForm" novalidate="" shown="true" onaftersave="saveForm()">
                                                        <div class="table-responsive prescription-1">
                                                            <div class="wrapper p-b">
                                                                <div class="pres-inner"  style="min-height:200px" >
                                                                    <table class="table table-striped b-t b-light" id="prescription_item">
                                                                        <thead>
                                                                            <tr>
                                                                                <th width="30" align="left" valign="middle">Actions</th>
                                                                                <th width="165" class="pres-main-product" align="left" valign="middle">Product</th>
                                                                                <th width="65" class="pres-main-route" align="left" valign="middle">Route</th>
                                                                                <th width="75" align="left" class="pres-main-freq" valign="middle">Frequency</th>
                                                                                <th width="5"></th>
                                                                                <th width="70" align="center" class="pres-main-noofdays" valign="middle">No.of </br> Days</th>
                                                                                <th width="25" align="center" class="pres-main-qty" valign="middle">Qty</th>
                                                                                <!--<th width="50" align="center">Cost</th>-->
                                                                                <th width="100" align="center" class="pres-main-afbf" valign="middle">AF / BF</th>
                                                                                <th width="45" align="center" class="pres-main-remarks" valign="middle">Remarks</th>
                                                                                <th width="20" align="center" class="pres-main-fav" valign="middle">Fav</th>
                                                                                <th width="35" align="right"  class="pres-main-total" valign="middle" class="text-right prescription-total-b-l">Total</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>                                                   
                                                                            <tr class="{{((item.available_quantity == 0 || !item.in_stock) && presc_stock_status == 1) ? 'out_of_stock' : ''}}" ng-repeat="item in data.prescriptionItems" ng-init="key = item.item_key">
                                                                                <td align="center">                                                         
                                                                                    <button type="button" class="label bg-info" ng-click="removeItem(item)"><i class=" fa fa-trash"></i></button>
                                                                                </td>
                                                                                <td>
                                                                                    <!--e-ng-options="product.full_name as product.full_name for product in item.all_products | filter:$viewValue | filter:{generic_id : item.generic_id} : true"--> 
                                                                                    <span editable-select="item.product_id"
                                                                                          e-index ="{{item.item_key}}"
                                                                                          e-tabindex="2{{item.item_key}}1"
                                                                                          e-class="form-control"
                                                                                          e-name="product_id" 
                                                                                          e-form="tableform" 
                                                                                          onbeforesave="checkInput($data)" 
                                                                                          e-ng-change="setProductId($data, item.item_key, tableform)" 
                                                                                          e-ng-options="product.product_id as product.full_name for product in item.all_products" 
                                                                                          e-options-class="{ 'in-stock' : availableQuantity, 'out-of-stock': !availableQuantity }"
                                                                                          e-required>
                                                                                        {{ showProduct(item)}}
                                                                                    </span>                                                            
                                                                                </td>
                                                                                <td>
                                                                                    <span editable-select="item.route" 
                                                                                          e-index ="{{item.item_key}}"
                                                                                          e-tabindex="2{{item.item_key}}2"
                                                                                          e-class="form-control m-b"
                                                                                          e-name="route" 
                                                                                          e-form="tableform" 
                                                                                          e-ng-change="setRouteId($data, item.item_key)" 
                                                                                          onbeforesave="checkInput($data)"
                                                                                          e-id="route"
                                                                                          e-ng-options="route.route_name as route.route_name for route in item.description_routes | filter:$viewValue" 
                                                                                          e-required>
                                                                                        {{ showRoute(item)}}
                                                                                    </span>                                                            
                                                                                </td>
                                                                                <td> 
                                                                                    <div id="freq_{{item.item_key}}_3" class="freq_div_{{item.item_key}} freq_3_times" style="width: 75%; float:left">
                                                                                        <!--                                                                                        e-typeahead-editable="true"
                                                                                                                                                                                      e-typeahead="consFreq.freq_name_0 for consFreq in currPresMask3 | filter:$viewValue | unique: 'freq_name_0'"
                                                                                                                                                                                      e-typeahead-on-select="freqChange($item.freq_name_0, '3', item, item.item_key, tableform, '0')"
                                                                                                                                                                                e-typeahead-focus=""-->
                                                                                        <span editable-text="item.frequency_3_0"                                                                                              
                                                                                              e-auto-complete
                                                                                              e-ac-options="autoCompleteOptions_3_0"
                                                                                              e-index ="{{item.item_key}}"
                                                                                              e-tabindex="2{{item.item_key}}3"
                                                                                              e-class="form-control m-b frequency_{{item.item_key}} freq_editable"
                                                                                              e-name="masked" 
                                                                                              e-model-view-value="true"
                                                                                              e-form="tableform" 
                                                                                              e-autocomplete="off"
                                                                                              e-id="frequency_{{item.item_key}}_3_0"
                                                                                              e-ng-change="freqChange($data, '3', item, item.item_key, tableform, '0')"
                                                                                              e-select-on-click=""
                                                                                              e-maxlength="4"
                                                                                              e-number-mask=""
                                                                                              onbeforesave="checkFrequency($data, item, item.item_key, '3', '0')"
                                                                                              e-required>
                                                                                            {{ selectFreq('3', '0', item, item.item_key)}}
                                                                                        </span>
                                                                                        <span editable-text="item.frequency_3_1"
                                                                                              e-auto-complete
                                                                                              e-ac-options="autoCompleteOptions_3_1"
                                                                                              e-index ="{{item.item_key}}"
                                                                                              e-tabindex="2{{item.item_key}}3"
                                                                                              e-class="form-control m-b frequency_{{item.item_key}} freq_editable"
                                                                                              e-name="masked" 
                                                                                              e-model-view-value="true"
                                                                                              e-form="tableform" 
                                                                                              e-autocomplete="off"
                                                                                              e-id="frequency_{{item.item_key}}_3_1"
                                                                                              e-ng-change="freqChange($data, '3', item, item.item_key, tableform, '1')"
                                                                                              e-select-on-click=""
                                                                                              e-maxlength="4"
                                                                                              e-number-mask=""
                                                                                              onbeforesave="checkFrequency($data, item, item.item_key, '3', '1')"
                                                                                              e-required>
                                                                                            {{ selectFreq('3', '1', item, item.item_key)}}
                                                                                        </span>
                                                                                        <span editable-text="item.frequency_3_2"
                                                                                              e-auto-complete
                                                                                              e-ac-options="autoCompleteOptions_3_2"
                                                                                              e-index ="{{item.item_key}}"
                                                                                              e-tabindex="2{{item.item_key}}3"
                                                                                              e-class="form-control m-b frequency_{{item.item_key}} freq_editable"
                                                                                              e-name="masked" 
                                                                                              e-model-view-value="true"
                                                                                              e-form="tableform" 
                                                                                              e-autocomplete="off"
                                                                                              e-id="frequency_{{item.item_key}}_3_2"
                                                                                              e-ng-change="freqChange($data, '3', item, item.item_key, tableform, '2')"
                                                                                              e-select-on-click=""
                                                                                              e-maxlength="4"
                                                                                              e-number-mask=""
                                                                                              onbeforesave="checkFrequency($data, item, item.item_key, '3', '2')"
                                                                                              e-required>
                                                                                            {{ selectFreq('3', '2', item, item.item_key)}}
                                                                                        </span>
                                                                                    </div>
                                                                                    <div id="freq_{{item.item_key}}_4" class="freq_div_{{item.item_key}} hide freq_4_times" style="width: 75%; float:left">
                                                                                        <span editable-text="item.frequency_4_0"
                                                                                              e-auto-complete
                                                                                              e-ac-options="autoCompleteOptions_4_0"
                                                                                              e-index ="{{item.item_key}}"
                                                                                              e-tabindex="2{{item.item_key}}3"
                                                                                              e-class="form-control m-b frequency_{{item.item_key}} freq_editable"
                                                                                              e-name="masked" 
                                                                                              e-model-view-value="true"
                                                                                              e-form="tableform" 
                                                                                              e-autocomplete="off"
                                                                                              e-id="frequency_{{item.item_key}}_4_0"
                                                                                              e-ng-change="freqChange($data, '4', item, item.item_key, tableform, 0)"
                                                                                              e-select-on-click=""
                                                                                              e-maxlength="4"
                                                                                              e-number-mask=""
                                                                                              onbeforesave="checkFrequency($data, item, item.item_key, '4', '0')"
                                                                                              e-required>
                                                                                            {{ selectFreq('4', '0', item, item.item_key)}}
                                                                                        </span>
                                                                                        <span editable-text="item.frequency_4_1"
                                                                                              e-auto-complete
                                                                                              e-ac-options="autoCompleteOptions_4_1"
                                                                                              e-index ="{{item.item_key}}"
                                                                                              e-tabindex="2{{item.item_key}}3"
                                                                                              e-class="form-control m-b frequency_{{item.item_key}} freq_editable"
                                                                                              e-name="masked" 
                                                                                              e-model-view-value="true"
                                                                                              e-form="tableform" 
                                                                                              e-autocomplete="off"
                                                                                              e-id="frequency_{{item.item_key}}_4_1"
                                                                                              e-ng-change="freqChange($data, '4', item, item.item_key, tableform, 1)"
                                                                                              e-select-on-click=""
                                                                                              e-maxlength="4"
                                                                                              e-number-mask=""
                                                                                              onbeforesave="checkFrequency($data, item, item.item_key, '4', '1')"
                                                                                              e-required>
                                                                                            {{ selectFreq('4', '1', item, item.item_key)}}
                                                                                        </span>
                                                                                        <span editable-text="item.frequency_4_2"
                                                                                              e-auto-complete
                                                                                              e-ac-options="autoCompleteOptions_4_2"
                                                                                              e-index ="{{item.item_key}}"
                                                                                              e-tabindex="2{{item.item_key}}3"
                                                                                              e-class="form-control m-b frequency_{{item.item_key}} freq_editable"
                                                                                              e-name="masked" 
                                                                                              e-model-view-value="true"
                                                                                              e-form="tableform" 
                                                                                              e-autocomplete="off"
                                                                                              e-id="frequency_{{item.item_key}}_4_2"
                                                                                              e-ng-change="freqChange($data, '4', item, item.item_key, tableform, 2)"
                                                                                              e-select-on-click=""
                                                                                              e-maxlength="4"
                                                                                              e-number-mask=""
                                                                                              onbeforesave="checkFrequency($data, item, item.item_key, '4', '2')"
                                                                                              e-required>
                                                                                            {{ selectFreq('4', '2', item, item.item_key)}}
                                                                                        </span>
                                                                                        <span editable-text="item.frequency_4_3"
                                                                                              e-auto-complete
                                                                                              e-ac-options="autoCompleteOptions_4_3"
                                                                                              e-index ="{{item.item_key}}"
                                                                                              e-tabindex="2{{item.item_key}}3"
                                                                                              e-class="form-control m-b frequency_{{item.item_key}} freq_editable"
                                                                                              e-name="masked" 
                                                                                              e-model-view-value="true"
                                                                                              e-form="tableform" 
                                                                                              e-autocomplete="off"
                                                                                              e-id="frequency_{{item.item_key}}_4_3"
                                                                                              e-ng-change="freqChange($data, '4', item, item.item_key, tableform, 3)"
                                                                                              e-select-on-click=""
                                                                                              e-maxlength="4"
                                                                                              e-number-mask=""
                                                                                              onbeforesave="checkFrequency($data, item, item.item_key, '4', '3')"
                                                                                              e-required>
                                                                                            {{ selectFreq('4', '3', item, item.item_key)}}
                                                                                        </span>
                                                                                    </div>
                                                                                    <div id="freq_{{item.item_key}}_txt" class="freq_div_{{item.item_key}} freq_1_times hide" style="width: 75%; float:left">
                                                                                        <span editable-text="item.frequency"
                                                                                              e-index ="{{item.item_key}}"
                                                                                              e-tabindex="2{{item.item_key}}3"
                                                                                              e-class="form-control"
                                                                                              e-name="masked" 
                                                                                              e-form="tableform" 
                                                                                              e-autocomplete="off"
                                                                                              e-id="frequency_{{item.item_key}}_txt"
                                                                                              e-ng-change="curPrescFreqSele($data, 'txt', item, item.item_key, 'change')"
                                                                                              e-select-on-click=""
                                                                                              onbeforesave="checkFrequency($data, item, item.item_key, 'txt')"
                                                                                              e-required>
                                                                                            {{ item.frequency || 'empty' }}
                                                                                        </span>
                                                                                    </div>
                                                                                    <div style="width: 20px; float:left">
                                                                                        <div class="input-group-btn dropdown">
                                                                                            <button class="btn btn-default dropdown-toggle" ng-click="checkProducttype(item.description_name)" type="button" data-toggle="dropdown">
                                                                                                <span class="fa fa-ellipsis-v"></span>
                                                                                            </button>
                                                                                            <ul class="dropdown-menu curPrescFreq">
                                                                                                <!-- Mask 3 -->
                                                                                                <li ng-repeat="consFreq in currPresMask3| limitTo:3">
                                                                                                    <div class="row">
                                                                                                        <div class="col-sm-12">
                                                                                                            <a href ng-click="curPrescFreqSele(consFreq.freq_name, consFreq.freq_type, item, item.item_key, 'select')" class="col-sm-9">{{consFreq.freq_name}}</a>
                                                                                                            <a class="col-sm-3" title='Clear' ng-click="clearCache(consFreq.freq_id)">X</a>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </li>
                                                                                                <li class="dropdown-submenu" ng-if="currPresMask3.length > 3">
                                                                                                    <a tabindex="-1" href="#">More</a>
                                                                                                    <ul class="dropdown-menu">
                                                                                                        <li ng-repeat="consFreq in currPresMask3| limitTo:(3 - currPresMask3.length)">
                                                                                                            <div class="row">
                                                                                                                <div class="col-sm-12">
                                                                                                                    <a href ng-click="curPrescFreqSele(consFreq.freq_name, consFreq.freq_type, item, item.item_key, 'select')" class="col-sm-9">{{consFreq.freq_name}}</a>
                                                                                                                    <a class="col-sm-3" title='Clear' ng-click="clearCache(consFreq.freq_id)">X</a>
                                                                                                                </div>
                                                                                                            </div>
                                                                                                        </li>
                                                                                                    </ul>
                                                                                                </li>
                                                                                                <li class="divider"></li>
                                                                                                <!-- Mask 4 -->
                                                                                                <li ng-repeat="consFreq in currPresMask4| limitTo:3">
                                                                                                    <div class="row">
                                                                                                        <div class="col-sm-12">
                                                                                                            <a href ng-click="curPrescFreqSele(consFreq.freq_name, consFreq.freq_type, item, item.item_key, 'select')" class="col-sm-9">{{consFreq.freq_name}}</a>
                                                                                                            <a class="col-sm-3" title='Clear' ng-click="clearCache(consFreq.freq_id)">X</a>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </li>
                                                                                                <li class="dropdown-submenu" ng-if="currPresMask4.length > 3">
                                                                                                    <a tabindex="-1" href="#">More</a>
                                                                                                    <ul class="dropdown-menu">
                                                                                                        <li ng-repeat="consFreq in currPresMask4| limitTo:(3 - currPresMask4.length)">
                                                                                                            <div class="row">
                                                                                                                <div class="col-sm-12">
                                                                                                                    <a href ng-click="curPrescFreqSele(consFreq.freq_name, consFreq.freq_type, item, item.item_key, 'select')" class="col-sm-9">{{consFreq.freq_name}}</a>
                                                                                                                    <a class="col-sm-3" title='Clear' ng-click="clearCache(consFreq.freq_id)">X</a>
                                                                                                                </div>
                                                                                                            </div>
                                                                                                        </li>
                                                                                                    </ul>
                                                                                                </li>
                                                                                                <li class="divider"></li>
                                                                                                <!-- Mask Txt -->
                                                                                                <li ng-repeat="consFreq in currPresMaskTxt| limitTo:3">
                                                                                                    <div class="row">
                                                                                                        <div class="col-sm-12">
                                                                                                            <a href ng-click="curPrescFreqSele(consFreq.freq_name, consFreq.freq_type, item, item.item_key, 'select')" class="col-sm-9">{{consFreq.freq_name}}</a>
                                                                                                            <a class="col-sm-3" title='Clear' ng-click="clearCache(consFreq.freq_id)">X</a>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </li>
                                                                                                <li class="dropdown-submenu" ng-if="currPresMaskTxt.length > 3">
                                                                                                    <a tabindex="-1" href="#">More</a>
                                                                                                    <ul class="dropdown-menu">
                                                                                                        <li ng-repeat="consFreq in currPresMaskTxt| limitTo:(3 - currPresMaskTxt.length)">
                                                                                                            <div class="row">
                                                                                                                <div class="col-sm-12">
                                                                                                                    <a href ng-click="curPrescFreqSele(consFreq.freq_name, consFreq.freq_type, item, item.item_key, 'select')" class="col-sm-9">{{consFreq.freq_name}}</a>
                                                                                                                    <a class="col-sm-3" title='Clear' ng-click="clearCache(consFreq.freq_id)">X</a>
                                                                                                                </div>
                                                                                                            </div>
                                                                                                        </li>
                                                                                                    </ul>
                                                                                                </li>
                                                                                            </ul>
                                                                                        </div>
                                                                                    </div>
                                                                                </td>
                                                                                <td>{{(item.description_name| uppercase) == 'SYRUP' ? "ml" : "" }}</td>
                                                                                <td align="center">
                                                                                    <!--                                                                                    e-typeahead-editable="true"
                                                                                                                                                                              e-typeahead="consNoofdays.number_of_days for consNoofdays in consultantNoofdays | unique: 'number_of_days' | limitTo:10 | filter:$viewValue:stateComparator"
                                                                                                                                                                              e-typeahead-on-select="numberDaysChange($item.number_of_days, item, item.item_key, tableform)"
                                                                                                                                                                        e-typeahead-focus=""-->
                                                                                    <span editable-text="item.number_of_days"
                                                                                          e-auto-complete
                                                                                          e-ac-options="autoCompleteOptionsNoofdays"                                                                                          
                                                                                          e-index ="{{item.item_key}}"
                                                                                          e-tabindex="2{{item.item_key}}4"
                                                                                          e-class="form-control"
                                                                                          e-name="number_of_days" 
                                                                                          e-form="tableform" 
                                                                                          onbeforesave="checkInput($data)"
                                                                                          e-autocomplete="off"
                                                                                          e-id="number_of_days"
                                                                                          e-ng-change="numberDaysChange($data, item, item.item_key, tableform)"
                                                                                          e-ng-blur="checkTextboxAction($data, item, item.item_key, tableform)"
                                                                                          e-number-mask=""
                                                                                          e-select-on-click=""
                                                                                          e-drop-disable
                                                                                          e-required>
                                                                                        {{ item.number_of_days || 'empty' }}
                                                                                    </span>
                                                                                </td>
                                                                                <td align="center">
                                                                                    <div id="qty_div_{{item.item_key}}">
                                                                                        <span editable-text="item.qty"
                                                                                              e-index ="{{item.item_key}}"
                                                                                              e-tabindex="1{{item.item_key}}5"
                                                                                              e-class="form-control"
                                                                                              e-name="qty" 
                                                                                              e-form="tableform" 
                                                                                              e-autocomplete="off"
                                                                                              e-id="qty_{{item.item_key}}"
                                                                                              e-ng-change="qtyChange($data, item, item.item_key, tableform)"
                                                                                              e-number-mask=""
                                                                                              e-select-on-click=""
                                                                                              e-drop-disable
                                                                                              e-required>
                                                                                            {{ item.qty || 'empty' }}
                                                                                        </span>
                                                                                    </div>
                                                                                </td>
                                                                                <!--                                                        <td>
                                                                                                                                            {{ item.price}}
                                                                                                                                        </td>-->
                                                                                <td>
                                                                                    <div class="m-b">
                                                                                        <div class="btn-group">
                                                                                            <label class="btn btn-xs btn-success" name="food_type_{{item.item_key}}" id="food_type_{{item.item_key}}" ng-model="item.food_type" btn-radio="'AF'">AF</label>
                                                                                            <label class="btn btn-xs btn-success" name="food_type_{{item.item_key}}" id="food_type_{{item.item_key}}" ng-model="item.food_type" btn-radio="'NA'">NA</label>
                                                                                            <label class="btn btn-xs btn-success" name="food_type_{{item.item_key}}" id="food_type_{{item.item_key}}" ng-model="item.food_type" btn-radio="'BF'">BF</label>
                                                                                        </div>
                                                                                    </div>
                                                                                </td>
                                                                                <td class="pres-remarks-field" align="center">
                                                                                    <span editable-text="item.remarks"
                                                                                          e-index ="{{item.item_key}}"
                                                                                          e-tabindex="2{{item.item_key}}6"
                                                                                          e-class="form-control"
                                                                                          e-name="remarks" 
                                                                                          e-form="tableform" 
                                                                                          e-autocomplete="off"
                                                                                          e-id="remarks"
                                                                                          e-required>
                                                                                        {{ item.remarks || 'empty' }}
                                                                                    </span>
                                                                                </td>
                                                                                <td>
                                                                                    <a href ui-toggle-class class="{{item.is_favourite ? 'active' : ''}}">
                                                                                        <i class="fa fa-star-o text-muted text" ng-click="updateFavourite(1, item.product_id)"></i>
                                                                                        <i class="fa fa-star text-info text-active" ng-click="updateFavourite(0, item.product_id)"></i> 
                                                                                    </a>
                                                                                </td>
                                                                                <td class="text-right prescription-total-b-l">
                                                                                    {{ item.total | number:2}}
                                                                                </td>
                                                                            </tr>                                                    
                                                                        </tbody>
                                                                        <!--                                                                        <tbody ng-show="isLoading">
                                                                                                                                                    <tr>
                                                                                                                                                        <td colspan="11" class="text-center"><i class="fa fa-spin fa-refresh"></i></td>
                                                                                                                                                    </tr>
                                                                                                                                                </tbody>-->
                                                                    </table>
                                                                </div>                                     
                                                            </div>
                                                        </div>
                                                        <footer class="panel-footer">
                                                            <div class="row">
                                                                <div class="table-responsive">
                                                                    <div class="text-center" style="color:#a94442" ng-if="duplicateErrormessage != ''">{{duplicateErrormessage}}</div>
                                                                    <table class="table noborder">
                                                                        <tr>
                                                                            <td width="785"  align="left">
                                                                                <div class="form-horizontal">
                                                                                    <div class="form-inline">
                                                                                        <div class="form-group">
                                                                                            <label for="exampleInputEmail2"><i class="fa fa-calendar"></i> <b> Next Vist </b></label> &nbsp; &nbsp;
                                                                                            <input type="text" id="next_visit_date_picker" class="form-control multimonthdatepicker" ng-model="data.next_visit" ng-click="open($event)" drop-disable prevent-enter="true" ng-change="setDayEmpty();
                                                                                                getDays();"/>
                                                                                        </div>
                                                                                        <div class="form-group">
                                                                                            <label for="exampleInputEmail2">
                                                                                                &nbsp; &nbsp; <i class="fa fa-calendar-o"></i> <b> No.of.Days </b>
                                                                                            </label> &nbsp;&nbsp;
                                                                                            <input type="text"
                                                                                                   autocomplete="off" 
                                                                                                   ng-model="data.number_of_days"  
                                                                                                   class="form-control text-center"
                                                                                                   drop-disable 
                                                                                                   number-mask
                                                                                                   maxlength="4"
                                                                                                   auto-complete
                                                                                                   ac-options="autoCompleteOptionsNoofdays"
                                                                                                   ng-blur="setDateEmpty(); getVisit();"
                                                                                                   ng-keypress="$event.keyCode == 13 && getVisit() && setDateEmpty()"
                                                                                                   />

                                                                                        </div>
                                                                                        <div class="form-group prescription-btns">   
                                                                                            &nbsp; 
                                                                                            <button class="btn btn-dark save-print" id="save_print" ng-click="getBtnId('print')"> 
                                                                                                <i class="fa fa-print"></i> Save & Print 
                                                                                            </button> &nbsp;
                                                                                            <button class="btn btn-info save-btn-1" id="save" ng-click="getBtnId('save')"> 
                                                                                                <i class="fa fa-check"></i> Save 
                                                                                            </button> &nbsp;

                                                                                            <!--                                                                                            <button class="btn btn-dark" id="clear" ng-click="clearPrescription()">  
                                                                                                                                                                                            <i class="fa fa-times"></i> Clear 
                                                                                                                                                                                        </button>-->
                                                                                            <a class="btn btn-dark" id="clear" ng-click="clearPrescription()">  
                                                                                                <i class="fa fa-times"></i> Clear 
                                                                                            </a>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </td>
                                                                            <td width="180" align="right" class="prescription-total">  
                                                                                <i class="fa fa-rupee"></i> 
                                                                                <strong> {{ priceTotal() | number:2}}</strong>
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </footer>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div ng-show="pres_status == 'prev'">
                                        <div class="notes-table">
                                            <div class="lter wrapper-md prev-h1">
                                                <h1 class="m-n h3">Previous Prescription</h1>
                                            </div>
                                            <div class="">
                                                <div class="panel panel-default">
                                                    <div class="row wrapper pb-sm">
                                                        <div class="col-sm-6">
                                                            <span ng-show="(previousPresSelected > 0 && represcribeSelected == 0)">
                                                                <button ng-click="addToCurrentPrescription()" class="btn btn-sm btn-primary">
                                                                    <i class="fa fa-retweet"></i> Add to prescription
                                                                </button>
                                                            </span>
                                                            <span ng-show="represcribeSelected > 0">
                                                                <button ng-click="addToReprescribe()" class="btn btn-sm btn-primary">
                                                                    <i class="fa fa-retweet"></i> Represcribe
                                                                </button>
                                                            </span>
                                                        </div>
                                                        <div class="col-sm-6 text-right">
                                                            <!--                                                            <div class="input-group">
                                                                                                                            <input placeholder="Filter by date" prevent-enter type="text" class="form-control" datepicker-popup="yyyy-MM-dd" ng-model="filterdate" is-open="opened" datepicker-options="dateOptions" close-text="Close" max-date="maxDate" date-disabled="disabled(date, 'day')" ng-change="loadPrevPrescriptionsList(filterdate);"/>
                                                                                                                            <span class="input-group-btn">
                                                                                                                                <button type="button" class="btn btn-default" ng-click="open($event)"><i class="glyphicon glyphicon-calendar"></i></button>
                                                                                                                            </span>
                                                                                                                        </div>-->
                                                            <select class="form-control search-dropdown" ng-model="day" ng-options="day.value as day.label for day in days">
                                                                <option value="">DD</option>
                                                            </select>
                                                            <select class="form-control search-dropdown" ng-model="month" ng-options="month.value as month.label for month in months">
                                                                <option value="">MM</option>
                                                            </select>
                                                            <select class="form-control search-dropdown" ng-model="year" ng-options="year.value as year.label for year in years">
                                                                <option value="">YYYY</option>
                                                            </select>
                                                            <button class="btn m-b-xs btn-grey"  ng-disabled=" (day && month && year) ? false : true" ng-click="loadPrevPrescriptionsList(year + '-' + month + '-' + day)">
                                                                &nbsp; &nbsp; <i class="fa fa-search"></i> &nbsp; &nbsp;
                                                            </button>
                                                            <button ng-click="day = ''; month = ''; year = ''; loadPrevPrescriptionsList()" class="btn m-b-xs  btn-dark">  
                                                                <i class="fa fa-times"></i> 
                                                            </button>
                                                        </div>    
                                                    </div>
                                                    <div ng-include="'tpl/patient_prescription/_previous_prescription.html'">
                                                        {% include 'tpl/patient_prescription/_previous_prescription.html' %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div ng-show="pres_status == 'favourite'">
                                        <div class="notes-table">
                                            <div class="lter b-b wrapper-md prev-h1">
                                                <h1 class="m-n h3">Favourites</h1>
                                            </div>
                                            <div class="">
                                                <div class="panel panel-default">
                                                    <ul class="list-group no-radius ">
                                                        <li class="list-group-item" ng-repeat="favourite in child.favourites">
                                                            <a class="btn btn-default btn-xs active" ui-toggle-class="" href="#"  ng-click="toggleFavourite(favourite.pres_fav_id)">
                                                                <i class="fa fa-star-o text-muted text"></i>
                                                                <i class="fa fa-star text-danger text-active"></i>
                                                            </a> &nbsp;
                                                            <a href="javascript:void(0)" ng-click="addFavouritePrescForm(favourite)">
                                                                {{favourite.product_name}}
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div ng-show="tab == 2">
                                    <div class="casehistory-form">
                                        <div class="row">
                                            <!--                                            <div class="panel-body">
                                                                                            Coming Soon
                                                                                        </div>-->

                                            <!-- Medical Case history Starting-->
                                            <div ng-if="medical_history == 'form'">
                                                <button class="pull-right btn m-b-xs btn-dark" style='margin-right: 16px;' ng-click="loadmedicalcasehistory()"> <i class="fa fa-arrow-left"></i> Back</button>
                                                <div class="col-sm-12">
                                                    <!-- Past medical history section start -->
                                                    <div class="panel-body" ng-show = "pastMedical.length > 0">
                                                        <div class="panel panel-default">
                                                            <div class="panel-heading bg-default">
                                                                <b>Past Medical History</b>
                                                            </div>
                                                            <div class="panel-body" style="height:150px;overflow:scroll;overflow-x:hidden;overflow-y:scroll;">
                                                                <table width='100%' class="table table-striped b-t b-light" >
                                                                    <thead>
                                                                        <tr>
                                                                            <th>Date</th>
                                                                            <th>Encounter</th>
                                                                            <th>Past Medical Notes</th>
                                                                            <th>Created By</th>
                                                                            <th>Action</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr ng-repeat="past in pastMedical">
                                                                            <td>{{past.created_at| moment:'DD/MM/YYYY - hh:mm A'}}</td>
                                                                            <td>{{past.encounter_id}}</td>
                                                                            <td class="v-middle">
                                                                                <span editable-textarea="past.past_medical"  e-rows="3" e-cols="40" e-name="past_medical" e-form="pastmedicalform" onbeforesave="checkName($data)" e-required>
                                                                                    {{ past.past_medical || 'empty' }}
                                                                                </span>
                                                                            </td>
                                                                            <td>{{past.created_by}}</td>
                                                                            <td style="white-space: nowrap">
                                                                                <!-- form -->
                                                                                <form editable-form name="pastmedicalform" onbeforesave="updatePastmedical($data, past.pat_past_medical_id)" ng-show="pastmedicalform.$visible" class="form-buttons form-inline">
                                                                                    <button type="submit" ng-disabled="pastmedicalform.$waiting" class="btn m-b-xs btn-info save-btn">
                                                                                        Save
                                                                                    </button>
                                                                                    <button type="button" ng-disabled="pastmedicalform.$waiting" ng-click="pastmedicalform.$cancel()" class="btn m-b-xs btn-default">
                                                                                        Cancel
                                                                                    </button>
                                                                                </form>
                                                                                <div class="buttons" ng-show="!pastmedicalform.$visible">
                                                                                    <button class="btn m-b-xs  btn-primary " ng-click="pastmedicalform.$show()"> <i class="fa fa-pencil"></i> Edit</button> 
                                                                                </div>  
                                                                            </td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- Past medical history section End -->
                                                    <div ng-include="'tpl/blocks/alert.html'">
                                                        {% include 'tpl/blocks/alert.html' %}
                                                    </div>
                                                    <div class="clearfix"></div>
                                                    
                                                    
                                                    <div class="panel-body" style="height:100vh; width:100%; float:left; position: relative;">
                                                        <div style="width:100%; float: left;" ui-layout="" options="{flow:'column', minSizes:['99%', '1%'], maxSizes:['1%', '99%']}" class="stretch ui-layout-column">
                                                            <div class=" a-back">  
                                                                <div class="innerdragleft">
                                                                    <div class="panel-body">
                                                                        <div ng-bind-html="xml | xslt:xslt | sanitize"></div>
                                                                    </div>

                                                                    <footer class="panel-footer text-right bg-light lter">
                                                                        <button class="btn m-b-xs  btn-success" ng-click="savemedicalForm()">Save</button>
                                                                        &nbsp;
                                                                        <button class="btn m-b-xs  btn-dark" ng-click="clearmedicalForm()"> <i class="fa fa-times"></i> Cancel</button>
                                                                    </footer>
                                                                </div>
                                                            </div>
                                                            <div class="b-back">
                                                                <div class="col-sm-12 innerdragleft">
                                                                    <select class="form-control" ng-model="data.current_mch_id" ng-options="MCHdocuments.doc_id as MCHdocuments.document_details for MCHdocuments in MCHdocument| orderBy: '-doc_id'" ng-change="getdocumentdetails()">
                                                                        <option value="">Select Medical Case History</option>
                                                                    </select>
                                                                    <table id='print_medical_case' style="width:100%">
                                                                        <tbody>
                                                                            <tr>
                                                                                <td colspan="3">
                                                                                    <div ng-show="view_xml" ng-bind-html="view_xml | xslt:viewxslt | sanitize"></div> 
                                                                                </td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
<!--                                                    <div class="col-sm-6">
                                                        <div class="panel-body">
                                                            <div ng-bind-html="xml | xslt:xslt | sanitize"></div>
                                                        </div>

                                                        <footer class="panel-footer text-right bg-light lter">
                                                            <button class="btn m-b-xs  btn-success" ng-click="savemedicalForm()">Save</button>
                                                            &nbsp;
                                                            <button class="btn m-b-xs  btn-dark" ng-click="clearmedicalForm()"> <i class="fa fa-times"></i> Cancel</button>
                                                        </footer>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <select class="form-control" ng-model="data.current_mch_id" ng-options="MCHdocuments.doc_id as MCHdocuments.document_details for MCHdocuments in MCHdocument| orderBy: '-doc_id'" ng-change="getdocumentdetails()">
                                                            <option value="">Select Medical Case History</option>
                                                        </select>
                                                        <table id='print_medical_case' style="width:100%">
                                                            <tbody>
                                                                <tr>
                                                                    <td colspan="3">
                                                                        <div ng-show="view_xml" ng-bind-html="view_xml | xslt:viewxslt | sanitize"></div> 
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>

                                                    </div>-->
                                                </div>
                                            </div>

                                            <div ng-if="medical_history == 'view'">
                                                <button class="pull-right btn m-b-xs  btn-dark" style='margin-right: 16px;' ng-click="loadmedicalcasehistory()"> <i class="fa fa-arrow-left"></i> Back</button>
                                                <div class="col-sm-12">
                                                    <div class="panel-body" ng-show = "pastMedical.length > 0">
                                                        <div class="panel panel-default">
                                                            <div class="panel-heading bg-default">
                                                                <b>Past Medical History</b>
                                                            </div>
                                                            <div class="panel-body" style="height:150px;overflow:scroll;overflow-x:hidden;overflow-y:scroll;">
                                                                <table width='100%' class="table table-striped b-t b-light" >
                                                                    <thead>
                                                                        <tr>
                                                                            <th>Date</th>
                                                                            <th>Encounter</th>
                                                                            <th>Past Medical Notes</th>
                                                                            <th>Created By</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr ng-repeat="past in pastMedical">
                                                                            <td>{{past.created_at| moment:'DD/MM/YYYY - hh:mm A'}}</td>
                                                                            <td>{{past.encounter_id}}</td>
                                                                            <td>{{past.past_medical}}</td>
                                                                            <td>{{past.created_by}}</td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div ng-bind-html="view_xml | xslt:viewxslt | sanitize"></div>
                                                    <footer class="panel-footer text-right bg-light lter">
                                                        <button class="btn m-b-xs  btn-success" ng-click="printMedicalcasedocument()">Print</button>
                                                        &nbsp;
                                                        <button class="btn m-b-xs  btn-dark" ng-click="loadmedicalcasehistory()"> <i class="fa fa-times"></i> Cancel</button>
                                                    </footer>
                                                    <div ng-hide='true' id='printCasedocument'>
                                                        <table id="medical_case_history" style="width:100%">
                                                            <tbody>
                                                                <tr>
                                                                    <td colspan="3" ng-bind-html="view_xml | xslt:printxslt | sanitize">
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>

                                            </div>

                                            <div ng-if="medical_history == 'index'" class="col-sm-12" ng-hide="isLoading">
                                                <div ng-include="'tpl/blocks/alert.html'">
                                                    {% include 'tpl/blocks/alert.html' %}
                                                </div>
                                                <div class="create-vitals-table">
                                                    <div class="row wrapper">
                                                        <div class="col-sm-12">
                                                            <button class="btn btn-info text-right" ng-click="initmedicalhistory()" style="">
                                                                <i class="fa fa-plus"></i> Create Document
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <table class="table table-striped b-t b-light">
                                                        <thead>
                                                            <tr>
                                                                <th>
                                                                    <button class="btn btn-sm btn-default hms-plus" type="button" ng-click="ctrl.expandAll(allExpanded = !allExpanded)">
                                                                        <i ng-if="!allExpanded" class="fa fa-plus text"></i>
                                                                        <i ng-if="allExpanded" class="fa fa-minus text"></i>
                                                                    </button>
                                                                </th>
                                                                <th>Branch</th>
                                                                <th>Document Date</th>
                                                                <th>Document Type</th>
                                                                <th>Document Name</th>
                                                                <th>Created By</th>
                                                                <th>Actions</th>
                                                            </tr>
                                                        </thead>

                                                        <tbody ng-show="isLoading">
                                                            <tr>
                                                                <td colspan="6" class="text-center"><i class="fa fa-spin fa-refresh"></i></td>
                                                            </tr>
                                                        </tbody>

                                                        <tbody ng-hide="isLoading">
                                                            <tr ng-if="MCHCollection.length == 0">
                                                                <td colspan="6" class="text-center">
                                                                    No Records Found
                                                                </td>
                                                            </tr>
                                                            <tr ng-repeat-start="(key, value) in MCHCollection" ng-init="expanded = (key == 0) ? true : false;">
                                                                <td>
                                                                    <button ng-click="expanded = !expanded" expand class="btn btn-sm btn-default hms-plus">
                                                                        <i ng-if="!expanded" class="fa fa-plus text"></i>
                                                                        <i ng-if="expanded" class="fa fa-minus text"></i>
                                                                    </button>
                                                                </td>
                                                                <td colspan="6">
                                                                    <b>
                                                                        <!--                                                                        <span class="badge bg-primary">Branch: {{value.tenant_name}}</span>&nbsp; &nbsp;-->
                                                                        <span class="badge bg-black">Encounter: {{value.encounter_id}}</span>&nbsp; &nbsp; 
                                                                    </b>
                                                                </td>
                                                            </tr>
                                                            <tr ng-repeat-end ng-show="expanded" ng-repeat="(doc_key, doc) in value.all">
                                                                <td align="center" valign="middle"></td>
                                                                <td valign="middle">{{doc.tenant_name}}</td>
                                                                <td valign="middle"> {{doc.date_time| moment:'DD/MM/YYYY - hh:mm A'}} </td>
                                                                <td valign="middle"> 
                                                                    <span ng-if="doc.doc_type == 'CH' && doc.status == '0'">
                                                                        <img ng-src="img/incomplete.gif" title="InComplete"  alt="InComplete" width="" height="" />
                                                                    </span>
                                                                    {{doc.doc_type_name}} 
                                                                </td>
                                                                <td valign="middle"> {{doc.doc_name}} </td>
                                                                <td valign="middle"> {{doc.created_by}} </td>
                                                                <td valign="middle">
                                                                    <a class="label bg-dark" title="View" ng-click="viewMedicaldocument(doc.doc_id)">
                                                                        <i class="fa fa-eye"></i>
                                                                    </a> &nbsp;
                                                                    <a class="label bg-dark" title="Edit" ng-click="Updatemedicaldocument(doc.doc_id)">
                                                                        <i class="fa fa-pencil"></i>
                                                                    </a> &nbsp;
                                                                    <button type="button" title="Delete"  ng-click="deleteDocument(doc.doc_id, 'CH')" class="label bg-dark">
                                                                        <i class="fa fa-trash"></i>
                                                                    </button> &nbsp;
                                                                    <a class="label bg-dark" title="Print" ng-click="printMedicaldocument(doc.doc_id)">
                                                                        <i class="fa fa-print"></i>
                                                                    </a>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="col-lg-12" ng-show="isLoading">
                                                <div class="text-center"><i class="fa fa-spin fa-refresh"></i></div>
                                            </div>
                                            <!-- Medical Case history Ending-->
                                        </div>
                                    </div>
                                </div>

                                <div ng-show="tab == 3" class="vitals-tab">
                                    <div class="row" ng-init="vitaldata                                         =                                         {}; 
                                        vitaldata.formtype                     =                     'add'">
                                        <div class="col-lg-12" ng-hide="isLoading"> 
                                            <!-- accordion -->
                                            <accordion close-others="oneAtATime">
                                                <accordion-group is-open="status.open"  class="">
                                                    <accordion-heading><i class="fa fa-plus" ng-class="{'fa-minus': status.open, 'fa-plus': !status.open}"></i> &nbsp;&nbsp;Add Vitals</accordion-heading>

                                                    <div>
                                                        <form name="vitalForm" class="form-horizontal form-validation">
                                                            <div class="create-vitals">
                                                                <div ng-include="'tpl/blocks/alert.html'">
                                                                    {% include 'tpl/blocks/alert.html' %}
                                                                </div>

                                                                <div class="col-sm-2">
                                                                    <label>Encounter # :</label>
                                                                    {{enc.selected.encounter_id}} </div>
                                                                <div class="col-sm-3">
                                                                    <label>Date: </label>
                                                                    {{enc.selected.encounter_date}} </div>
                                                                <div class="col-sm-7">
                                                                    <label>&nbsp; </label>
                                                                    &nbsp;</div> 
                                                                <div class="clearfix"></div>

                                                                <div class="col-sm-1" ng-show="(vitalcong.Temperature == 1)">
                                                                    <label>Temperature </label>
                                                                    <div class="input-group m-b">
                                                                        <input type="text" maxlength="5" class="form-control" placeholder="" ng-model="vitaldata.temperature" number-mask="" one-decimal-places>
                                                                        <span class="input-group-addon">°C</span> </div>
                                                                </div>

                                                                <div class="col-sm-2" ng-show="(vitalcong.BP == 1)">
                                                                    <label>Blood Pressure &nbsp; &nbsp; &nbsp; </label>
                                                                    <input type="text" maxlength="3" class="form-control" placeholder="Systolic" ng-model="vitaldata.blood_pressure_systolic" number-mask="">
                                                                </div>

                                                                <div class="col-sm-2" ng-show="(vitalcong.BP == 1)">
                                                                    <label>&nbsp;</label>
                                                                    <div class="input-group m-b">
                                                                        <input type="text" maxlength="3" class="form-control" placeholder="Diastolic" ng-model="vitaldata.blood_pressure_diastolic" number-mask="">
                                                                        <span class="input-group-addon">mmHg </span> </div>
                                                                </div>

                                                                <div class="col-sm-2" ng-show="(vitalcong.Pulse == 1)">
                                                                    <label>Pulse </label>
                                                                    <div class="input-group m-b">
                                                                        <input type="text" maxlength="5" class="form-control" placeholder="" ng-model="vitaldata.pulse_rate" number-mask="">
                                                                        <span class="input-group-addon">Beats</span> </div>
                                                                </div>

                                                                <div class="col-sm-1" ng-show="(vitalcong.Weight == 1)">
                                                                    <label>Weight </label>
                                                                    <div class="input-group m-b">
                                                                        <input type="text" maxlength="5" class="form-control" placeholder="" ng-model="vitaldata.weight" ng-blur="Calculatebmi()" number-mask="" two-decimal-places>
                                                                        <span class="input-group-addon">Kg</span> </div>
                                                                </div>

                                                                <div class="col-sm-1" ng-show="(vitalcong.Height == 1)">
                                                                    <label>Height </label>
                                                                    <div class="input-group m-b">
                                                                        <input type="text" maxlength="5" class="form-control" placeholder="" ng-model="vitaldata.height" ng-blur="Calculatebmi()" number-mask="" two-decimal-places>
                                                                        <span class="input-group-addon">Cm</span> </div>
                                                                </div>

                                                                <div class="col-sm-1" ng-show="(vitalcong.SP02 == 1)">
                                                                    <label>SP02 </label>
                                                                    <input type="text" maxlength="5" class="form-control" placeholder="" ng-model="vitaldata.sp02" number-mask="" two-decimal-places>
                                                                </div>

                                                                <div class="col-sm-1" ng-show="(vitalcong.Pain_Score == 1)">
                                                                    <label>Pain Score </label>
                                                                    <input type="text" maxlength="5" class="form-control" placeholder="" ng-model="vitaldata.pain_score" number-mask="" two-decimal-places>
                                                                </div>

                                                                <div class="col-sm-1" ng-show="(vitalcong.BMI == 1)">
                                                                    <label>BMI </label>
                                                                    <input type="text" maxlength="5" class="form-control" placeholder="" ng-model="vitaldata.bmi" readonly='true' number-mask="" two-decimal-places>
                                                                </div>

                                                                <div class=" form-group text-right col-sm-12">
                                                                    <label>&nbsp;</label>
                                                                    <button class="btn m-b-xs  btn-success save-btn" ng-disabled="vital_enable_count" ng-click="savevitalForm(vitaldata.formtype)">Save</button>
                                                                    &nbsp;
                                                                    <button class="btn m-b-xs  btn-dark" ng-click="resetvitalForm()">
                                                                        <i class="fa fa-times"></i> Clear
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </form>
                                                    </div>
                                                    <div class="line line-dashed b-b line-lg "></div>
                                                    <div class="create-vitals-table"> 
                                                        <div class="font-bold">Vitals</div>
                                                        <div class="panel-body">
                                                            <table st-table="vitaldisplayedCollection"  st-safe-src="vitalCollection"  class="table table-striped b-t b-light">
                                                                <thead>
                                                                    <tr>
                                                                        <th>
                                                                            <button class="btn btn-sm btn-default hms-plus" type="button" ng-click="ctrl.expandAll(allExpanded = !allExpanded)">
                                                                                <i ng-if="!allExpanded" class="fa fa-plus text"></i>
                                                                                <i ng-if="allExpanded" class="fa fa-minus text"></i>
                                                                            </button>
                                                                        </th>
                                                                        <th>Branch</th>
                                                                        <th>Vital Time</th>
                                                                        <th>Temperature</th>
                                                                        <th>Blood Pressure</th>
                                                                        <th>Pulse Rate</th>
                                                                        <th>Weight</th>
                                                                        <th>Height</th>
                                                                        <th>SP02</th>
                                                                        <th>Pain Score</th>
                                                                        <th>BMI</th>
                                                                        <th>Action</th>
                                                                    </tr>
                                                                </thead>

                                                                <tbody ng-hide="isLoading">
                                                                    <tr ng-if="vitaldisplayedCollection.length == 0">
                                                                        <td colspan="12" class="text-center">
                                                                            No Records Found
                                                                        </td>
                                                                    </tr>
                                                                    <tr ng-repeat-start="(key, value) in vitaldisplayedCollection" ng-init="expanded = (key == 0) ? true : false;">
                                                                        <td>
                                                                            <button ng-click="expanded = !expanded" expand class="btn btn-sm btn-default hms-plus">
                                                                                <i ng-if="!expanded" class="fa fa-plus text"></i>
                                                                                <i ng-if="expanded" class="fa fa-minus text"></i>
                                                                            </button>
                                                                        </td>
                                                                        <td colspan="12">
                                                                            <!--                                                                            <span class="badge bg-success">Branch: {{value.branch_name}}</span>&nbsp; &nbsp;-->
                                                                            <span class="badge bg-primary">Encounter: {{value.encounter_id}}</span>&nbsp; &nbsp;
                                                                        </td>
                                                                    </tr>
                                                                    <tr ng-repeat-end ng-show="expanded" ng-repeat="(vital_key, vital) in value.all">
                                                                        <td>&nbsp;  </td>
                                                                        <td>{{vital.branch_name}}</td>
                                                                        <td> {{vital.vital_time| moment:'DD/MM/YYYY'}} &nbsp;
                                                                            <span class="label bg-light dk">{{vital.vital_time| moment:'hh:mm A'}}</span>
                                                                        </td>
                                                                        <td> {{vital.temperature|| '-'}} </td>
                                                                        <td> {{vital.blood_pressure_systolic|| '-'}} / {{vital.blood_pressure_diastolic|| '-'}}</td>
                                                                        <td> {{vital.pulse_rate|| '-'}} </td>
                                                                        <td> {{vital.weight|| '-'}} </td>
                                                                        <td> {{vital.height|| '-'}} </td>
                                                                        <td> {{vital.sp02|| '-'}} </td>
                                                                        <td> {{vital.pain_score|| '-'}} </td>
                                                                        <td> {{vital.bmi|| '-'}} </td>
                                                                        <td>
                                                                            <div ng-if="vital.tenant_id != null && vital.encounter_status">
                                                                                <a ng-show="vital.tenant_id == app.logged_tenant_id" data-button="patient.vitalUpdate({id: '{{$state.params.id}}', vital_id: '{{vital.vital_id}}'})" check-access-custom class="label bg-info dk" title="Edit" ng-click="updatevitalRow(vital.vital_id)">
                                                                                    <i class="fa fa-pencil"></i>
                                                                                </a>&nbsp;&nbsp;&nbsp;
                                                                                <a ng-show="vital.tenant_id == app.logged_tenant_id" title="Delete" ng-click="removevitalRow(vital.vital_id)" class="label bg-dark dk">
                                                                                    <i class="fa fa-trash"></i>
                                                                                </a>
                                                                            </div>
                                                                        </td>
                                                                    </tr>
                                                                </tbody>

                                                                <tbody ng-show="isLoading">
                                                                    <tr>
                                                                        <td colspan="12" class="text-center"><i class="fa fa-spin fa-refresh"></i></td>
                                                                    </tr>
                                                                </tbody>

                                                                <tfoot>
                                                                    <tr>
                                                                        <td colspan="12" class="text-center">
                                                                            <div st-pagination="" st-items-by-page="itemsByPage" st-displayed-pages="10"></div>
                                                                        </td>
                                                                    </tr>
                                                                </tfoot>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </accordion-group>
                                                <accordion-group is-open="status.isFirstOpen" is-disabled="status.isFirstDisabled">
                                                    <accordion-heading><i class="fa fa-minus" ng-class="{'fa-minus': status.isFirstOpen, 'fa-plus': !status.isFirstOpen}"></i> &nbsp;&nbsp;Graph </accordion-heading>
                                                    <div class="row">
                                                        <div class="col-md-6 graph1" ng-show="(vitalcong.Temperature == 1)">
                                                            <div class="panel panel-default">
                                                                <div class="panel-heading font-bold">Temperature</div>
                                                                <div class="panel-body">
                                                                    <div ng-if="tem_graph_data" ui-jq="plot" ui-refresh="tem_graph_data" ui-options="
                                                                         [
                                                                         { data: {{tem_graph_data}}, points: { show: true }, lines: { show: true, fillColor: { colors: [{ opacity: 0.1 }, { opacity: 0.1}] } } }
                                                                         ], 
                                                                         {
                                                                         colors: ['{{app.color.primary}}'],
                                                                         series: { shadowSize: 1 },
                                                                         xaxis:{
                                                                         tickLength: 0,
                                                                         ticks: ticks,
                                                                         min: 0.8, 
                                                                         max: 5.3,
                                                                         labelWidth: 10,
                                                                         font: { color: '#444444' },
                                                                         position: 'bottom',
                                                                         ticks: {{tem_graph_tick}}
                                                                         },
                                                                         yaxis:{ font: { color: '#444444' },
                                                                         min:80,
                                                                         max:120 },
                                                                         grid: { hoverable: true, clickable: true, borderWidth: 0, color: '#444444' },
                                                                         tooltip: true,
                                                                         tooltipOpts: { content: '%x is %y',  defaultTheme: false, shifts: { x: 0, y: 20 } }
                                                                         }
                                                                         " style="height:240px;width:100%" >
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6 graph1 graph2" ng-show="(vitalcong.BP == 1)">
                                                            <div class="panel panel-default">
                                                                <div class="panel-heading font-bold">Blood Pressure</div>
                                                                <div class="panel-body">
                                                                    <div ng-if="bps_graph_data" ui-jq="plot" ui-refresh="bps_graph_data" ui-options="
                                                                         [
                                                                         { data: {{bps_graph_data}}, label: 'systolic', points: { show: true }, lines: { show: true,  fillColor: { colors: [{ opacity: 0.1 }, { opacity: 0.1}] } } }, 
                                                                         { data: {{bpd_graph_data}}, label: 'diastolic', points: { show: true }, lines: { show: true, fillColor: { colors: [{ opacity: 0.1 }, { opacity: 0.1}] } } }
                                                                         ],
                                                                         {
                                                                         colors: [ '{{app.color.info}}','{{app.color.drak}}' ],
                                                                         series: { shadowSize: 1 },
                                                                         xaxis:{ 
                                                                         tickLength: 0,
                                                                         ticks: ticks,
                                                                         min: 0.8, 
                                                                         max: 5.3,
                                                                         labelWidth: 10,
                                                                         font: { color: '#444444' },
                                                                         position: 'bottom',
                                                                         ticks: {{bp_graph_tick}} },
                                                                         legend: {
                                                                         show: true,
                                                                         position: 'bottom',
                                                                         },
                                                                         yaxis:{ font: { color: '#444444' },min:0,
                                                                         max:200 },
                                                                         grid: { hoverable: true, clickable: true, borderWidth: 0, color: '#444444' },
                                                                         tooltip: true,
                                                                         tooltipOpts: { content: '%s of %x is %y',  defaultTheme: false, shifts: { x: 0, y: 20 } }
                                                                         }
                                                                         " style="height:240px;width:100%"></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6 graph1 graph3" ng-show="(vitalcong.Pulse == 1)">
                                                            <div class="panel panel-default">
                                                                <div class="panel-heading font-bold">Pulse Rate</div>
                                                                <div class="panel-body">
                                                                    <div ng-if="pulse_graph_data" ui-jq="plot" ui-refresh="pulse_graph_data" ui-options="
                                                                         [
                                                                         { data: {{pulse_graph_data}}, points: { show: true }, lines: { show: true, fillColor: { colors: [{ opacity: 0.1 }, { opacity: 0.1}] } } }
                                                                         ], 
                                                                         {
                                                                         colors: ['{{app.color.success}}'],
                                                                         series: { shadowSize: 3 },
                                                                         xaxis:{ 
                                                                         tickLength: 0,
                                                                         ticks: ticks,
                                                                         min: 0.8, 
                                                                         max: 5.3,
                                                                         labelWidth: 10,
                                                                         font: { color: '#444444' },
                                                                         position: 'bottom',
                                                                         ticks: {{pulse_graph_tick}}
                                                                         },
                                                                         yaxis:{ font: { color: '#444444' },min:15,
                                                                         max:150 },
                                                                         grid: { hoverable: true, clickable: true, borderWidth: 0, color: '#444444' },
                                                                         tooltip: true,
                                                                         tooltipOpts: { content: '%x is %y',  defaultTheme: false, shifts: { x: 0, y: 20 } }
                                                                         }
                                                                         " style="height:240px;width:100%" >
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6 graph1 graph4" ng-show="(vitalcong.Weight == 1)">
                                                            <div class="panel panel-default">
                                                                <div class="panel-heading font-bold">Weight</div>
                                                                <div class="panel-body">
                                                                    <div ng-if="weight_graph_data" ui-jq="plot" ui-refresh="weight_graph_data" ui-options="
                                                                         [
                                                                         { data: {{weight_graph_data}},points: { show: true }, lines: { show: true, fillColor: { colors: [{ opacity: 0.1 }, { opacity: 0.1}] } } }
                                                                         ], 
                                                                         {
                                                                         colors: ['{{app.color.warning}}'],
                                                                         series: { shadowSize: 3 },
                                                                         xaxis:{ 
                                                                         tickLength: 0,
                                                                         ticks: ticks,
                                                                         min: 0.8, 
                                                                         max: 5.3,
                                                                         labelWidth: 10,
                                                                         font: { color: '#444444' },
                                                                         position: 'bottom',
                                                                         ticks: {{weight_graph_tick}}
                                                                         },
                                                                         yaxis:{ font: { color: '#444444' },min:{{min_weight}},
                                                                         max:{{max_weight}},ticks:8 },
                                                                         grid: { hoverable: true, clickable: true, borderWidth: 0, color: '#444444' },
                                                                         tooltip: true,
                                                                         tooltipOpts: { content: '%x is %y',  defaultTheme: false, shifts: { x: 0, y: 20 } }
                                                                         }
                                                                         " style="height:240px;width:100%" >
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6 graph1 graph5" ng-show="(vitalcong.Height == 1)">
                                                            <div class="panel panel-default">
                                                                <div class="panel-heading font-bold">Height</div>
                                                                <div class="panel-body">
                                                                    <div ng-if="height_graph_data" ui-jq="plot" ui-refresh="height_graph_data" ui-options="
                                                                         [
                                                                         { data: {{height_graph_data}}, points: { show: true }, lines: { show: true, fillColor: { colors: [{ opacity: 0.1 }, { opacity: 0.1}] } } }
                                                                         ],
                                                                         {
                                                                         colors: ['{{app.color.danger}}'],
                                                                         series: { shadowSize: 3 },
                                                                         xaxis:{ 
                                                                         tickLength: 0,
                                                                         ticks: ticks,
                                                                         min: 0.8, 
                                                                         max: 5.3,
                                                                         labelWidth: 10,
                                                                         font: { color: '#444444' },
                                                                         position: 'bottom',
                                                                         ticks: {{height_graph_tick}}
                                                                         },
                                                                         yaxis:{ font: { color: '#444444' },min:30,
                                                                         max:200 },
                                                                         grid: { hoverable: true, clickable: true, borderWidth: 0, color: '#444444' },
                                                                         tooltip: true,
                                                                         tooltipOpts: { content: '%x is %y',  defaultTheme: false, shifts: { x: 0, y: 20 } }
                                                                         }
                                                                         " style="height:240px;width:100%" >
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6 graph1 graph6" ng-show="(vitalcong.SP02 == 1)">
                                                            <div class="panel panel-default">
                                                                <div class="panel-heading font-bold">SP02</div>
                                                                <div class="panel-body">
                                                                    <div ng-if="sp02_graph_data" ui-jq="plot" ui-refresh="sp02_graph_data" ui-options="
                                                                         [
                                                                         { data: {{sp02_graph_data}}, points: { show: true }, lines: { show: true, fillColor: { colors: [{ opacity: 0.1 }, { opacity: 0.1}] } } }
                                                                         ],
                                                                         {
                                                                         colors: ['{{app.color.primary}}'],
                                                                         series: { shadowSize: 3 },
                                                                         xaxis:{ 
                                                                         tickLength: 0,
                                                                         ticks: ticks,
                                                                         min: 0.8, 
                                                                         max: 5.3,
                                                                         labelWidth: 10,
                                                                         font: { color: '#444444' },
                                                                         position: 'bottom',
                                                                         ticks: {{sp02_graph_tick}}
                                                                         },
                                                                         yaxis:{ font: { color: '#444444' },min:0,
                                                                         max:100 },
                                                                         grid: { hoverable: true, clickable: true, borderWidth: 0, color: '#444444' },
                                                                         tooltip: true,
                                                                         tooltipOpts: { content: '%x is %y',  defaultTheme: false, shifts: { x: 0, y: 20 } }
                                                                         }
                                                                         " style="height:240px;width:100%" >
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6 graph1 graph7" ng-show="(vitalcong.Pain_Score == 1)">
                                                            <div class="panel panel-default">
                                                                <div class="panel-heading font-bold">Pain Score</div>
                                                                <div class="panel-body">
                                                                    <div ng-if="pain_graph_data" ui-jq="plot" ui-refresh="pain_graph_data" ui-options="
                                                                         [
                                                                         { data: {{pain_graph_data}}, points: { show: true }, lines: { show: true, fillColor: { colors: [{ opacity: 0.1 }, { opacity: 0.1}] } } }
                                                                         ],
                                                                         {
                                                                         colors: ['{{app.color.black}}'],
                                                                         series: { shadowSize: 3 },
                                                                         xaxis:{ 
                                                                         tickLength: 0,
                                                                         ticks: ticks,
                                                                         min: 0.8, 
                                                                         max: 5.3,
                                                                         labelWidth: 10,
                                                                         font: { color: '#444444' },
                                                                         position: 'bottom',
                                                                         ticks: {{pain_graph_tick}}
                                                                         },
                                                                         yaxis:{ font: { color: '#444444' },min:0,
                                                                         max:10 },
                                                                         grid: { hoverable: true, clickable: true, borderWidth: 0, color: '#444444' },
                                                                         tooltip: true,
                                                                         tooltipOpts: { content: '%x is %y',  defaultTheme: false, shifts: { x: 0, y: 20 } }
                                                                         }
                                                                         " style="height:240px;width:100%" >
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </accordion-group>
                                            </accordion>
                                        </div>
                                        <div class="col-lg-12" ng-show="isLoading">
                                            <div class="text-center"><i class="fa fa-spin fa-refresh"></i></div>
                                        </div>
                                    </div>
                                </div>

                                <div ng-show="tab == 4">
                                    <div class="row">
                                        <div class="col-lg-12" ng-hide="isLoading">
                                            <div ng-include="'tpl/blocks/alert.html'">
                                                {% include 'tpl/blocks/alert.html' %}
                                            </div>
                                            <div class="tab-results-cont">
                                                <div class="form-group pull-in clearfix">
                                                    <div class="col-sm-2">
                                                        <label class="control-label">Encounter # :</label>
                                                        {{enc.selected.encounter_id}} </div>
                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <label class="col-sm-3 control-label">Description : </label>
                                                            <div class="col-sm-9">
                                                                <textarea placeholder="Notes" class="form-control" ng-model="resultdata.results"></textarea>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-3">
                                                        <button class="btn m-b-xs  btn-success save-btn" ng-click="saveresultForm(resultdata.formtype)">Save</button>
                                                        &nbsp;
                                                        <button class="btn m-b-xs  btn-dark" ng-click="resetresultForm()">
                                                            <i class="fa fa-times"></i> Clear
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="line line-dashed b-b line-lg "></div>
                                            <div class="result-table">
                                                <div class="panel-heading font-bold">Results</div>
                                                <div class="panel-body">
                                                    <table st-table="resultdisplayedCollection"  st-safe-src="resultCollection"  class="table table-striped b-t b-light">
                                                        <thead>
                                                            <tr>
                                                                <th>
                                                                    <button class="btn btn-sm btn-default hms-plus" type="button" ng-click="ctrl.expandAll(allExpanded = !allExpanded)">
                                                                        <i ng-if="!allExpanded" class="fa fa-plus text"></i>
                                                                        <i ng-if="allExpanded" class="fa fa-minus text"></i>
                                                                    </button>
                                                                </th>
                                                                <th>Branch</th>
                                                                <th>Created By</th>
                                                                <th>Date</th>
                                                                <th>Results</th>
                                                                <th>Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody ng-hide="isLoading">
                                                            <tr ng-if="resultdisplayedCollection.length == 0">
                                                                <td colspan="6" class="text-center">
                                                                    No Records Found
                                                                </td>
                                                            </tr>
                                                            <tr ng-repeat-start="(key, value) in resultdisplayedCollection" ng-init="expanded = (key == 0) ? true : false;">
                                                                <td>
                                                                    <button ng-click="expanded = !expanded" expand class="btn btn-sm btn-default hms-plus">
                                                                        <i ng-if="!expanded" class="fa fa-plus text"></i>
                                                                        <i ng-if="expanded" class="fa fa-minus text"></i>
                                                                    </button>
                                                                </td>
                                                                <td colspan="6">
                                                                    <b> 
                                                                        <!--                                                                        <span class="badge bg-success">Branch: {{value.data.branch_name}}</span>&nbsp; &nbsp;-->
                                                                        <span class="badge bg-primary">Encounter: {{value.data.encounter_id}}</span>&nbsp; &nbsp; 
                                                                    </b>
                                                                </td>
                                                            </tr>
                                                            <!-- | orderBy: pat_note_id:reverse -->
                                                            <tr ng-repeat-end ng-show="expanded" ng-repeat="result in value.all">
                                                                <td align="center" valign="middle"></td>
                                                                <td>{{result.branch_name}}</td>
                                                                <td valign="middle">
                                                                    <span class="label bg-info">  {{result.created_by}} </span>
                                                                </td>
                                                                <td valign="middle"> {{result.created_at| moment:'DD/MM/YYYY'}} </td>
                                                                <td>
                                                                    <!--                                                                    <div tooltip-placement="left" data-tooltip-html-unsafe="{{result.concatenate_results ? result.full_results : ''}}"> <span ng-bind-html="result.short_results"></span> </div>-->
                                                                    <span ng-bind-html="result.full_results"></span>
                                                                </td>
                                                                <td valign="middle">
                                                                    <a ng-show="result.tenant_id == app.logged_tenant_id" class="label bg-dark" title="Edit" ng-click="updateResultFormRow(result.pat_result_id)">
                                                                        <i class="fa fa-pencil"></i>
                                                                    </a>&nbsp;&nbsp;&nbsp;
                                                                    <a ng-show="result.tenant_id == app.logged_tenant_id" data-button="patient.noteDelete" check-access-custom class="label bg-dark" title="Delete" ng-click="removeresultRow(result.pat_result_id)">
                                                                        <i class="fa fa-trash"></i>
                                                                    </a>
                                                                </td>
                                                            </tr>
                                                        </tbody>

                                                        <tbody ng-show="isLoading">
                                                            <tr>
                                                                <td colspan="6" class="text-center"><i class="fa fa-spin fa-refresh"></i></td>
                                                            </tr>
                                                        </tbody>

                                                        <tfoot>
                                                            <tr>
                                                                <td colspan="6" class="text-center">
                                                                    <div st-pagination="" st-items-by-page="itemsByPage" st-displayed-pages="7"></div>
                                                                </td>
                                                            </tr>
                                                        </tfoot>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-12" ng-show="isLoading">
                                            <div class="text-center"><i class="fa fa-spin fa-refresh"></i></div>
                                        </div>
                                    </div>
                                </div>

                                <div ng-show="tab == 5">
                                    <div class="row">
                                        <div class="col-lg-12" ng-hide="isLoading">
                                            <div>
                                                <form name="consultantForm" class="form-horizontal form-validation">
                                                    <div class="">
                                                        <div ng-include="'tpl/blocks/alert.html'">
                                                            {% include 'tpl/blocks/alert.html' %}
                                                        </div>

                                                        <div class="form-group pull-in clearfix">
                                                            <div class="col-sm-2">
                                                                <label class="control-label"> Encounter #  </label>
                                                                {{enc.selected.encounter_id}}
                                                                <label class="control-label"> Privacy &nbsp;&nbsp;</label>
                                                                <label class="i-checks "> 
                                                                    <input type="checkbox" name="status" ng-true-value="'1'" ng-false-value="'0'" ng-model="consFormData.privacy"> 
                                                                    <i></i> 
                                                                </label>
                                                            </div>
                                                            <div class="col-sm-3">
                                                                <label class="control-label">Date of Consultant Visit * </label>
                                                                <div class="input-group">
                                                                    <a class="dropdown-toggle" id="dropdown2" role="button" data-toggle="dropdown" data-target="#" href="javascript:void(0)">
                                                                        <div class="input-group">
                                                                            <input type="text" class="form-control" data-ng-model="consFormData.consult_date" data-date-time-input="YYYY-MM-DD hh:mm A" />
                                                                            <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                                                                        </div>
                                                                    </a>
                                                                    <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                                                                        <datetimepicker data-ng-model="data.consult_date" data-datetimepicker-config="{ dropdownSelector: '#dropdown2' }" data-before-render="beforeRender($view, $dates, $leftDate, $upDate, $rightDate)"/>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                            <div class="col-sm-3">
                                                                <label class="control-label">Consultant *</label> <br/>
                                                                <select class="selectpicker" data-live-search="true" ng-model="consFormData.consultant_id" ng-options="doctor.user_id  as doctor.consult_speciality_name for doctor in doctors| orderBy: 'name'" >
                                                                    <option value="">Select Consultant</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-sm-4">
                                                                <label class="control-label">Notes  </label>
                                                                <textarea placeholder="Notes" class="form-control" ng-model="consFormData.notes"></textarea>
                                                            </div>
                                                        </div>

                                                        <div class="form-group pull-in clearfix">
                                                            <div class="col-sm-12 text-right">
                                                                <label> </label>
                                                                <button class="btn m-b-xs  btn-success save-btn" ng-disabled="vital_enable_count" ng-click="saveConsultantForm(consFormData.formtype)">Save</button>
                                                                &nbsp;
                                                                <button class="btn m-b-xs  btn-dark" ng-click="resetconsultantForm()">
                                                                    <i class="fa fa-times"></i> Clear
                                                                </button>
                                                            </div>
                                                        </div>



                                                    </div>
                                                </form>
                                            </div>

                                            <div class="line line-dashed b-b line-lg "></div>

                                            <div class="result-table">
                                                <div class="panel-heading font-bold">Notes</div>
                                                <div class="panel-body">
                                                    <table st-table="displayedconsultantCollection"  st-safe-src="consultantCollection"  class="table table-striped b-t b-light">
                                                        <thead>
                                                            <tr>
                                                                <th width="22" >
                                                                    <button class="btn btn-sm btn-default hms-plus" type="button" ng-click="ctrl.expandAll(allExpanded = !allExpanded)">
                                                                        <i ng-if="!allExpanded" class="fa fa-plus text"></i>
                                                                        <i ng-if="allExpanded" class="fa fa-minus text"></i>
                                                                    </button>
                                                                </th>
                                                                <th width="150">Branch</th>
                                                                <th width="169">Date Of Visit</th>
                                                                <th width="300">Consultant</th>
                                                                <th width="300">Notes</th>
                                                                <th width="300">Created By</th>
                                                                <th width="150">Action</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody ng-hide="isLoading">
                                                            <tr ng-if="displayedconsultantCollection.length == 0">
                                                                <td colspan="6" class="text-center">
                                                                    No Records Found
                                                                </td>
                                                            </tr>
                                                            <tr ng-repeat-start="(key, value) in displayedconsultantCollection" ng-init="expanded = (key == 0) ? true : false;">
                                                                <td> <button ng-click="expanded = !expanded" expand class="btn btn-sm btn-default hms-plus">
                                                                        <i ng-if="!expanded" class="fa fa-plus text"></i>
                                                                        <i ng-if="expanded" class="fa fa-minus text"></i>
                                                                    </button>
                                                                </td>
                                                                <td colspan="4">
                                                                    <!--                                                                    <span class="badge bg-success">Branch: {{value.data.branch_name}}</span>&nbsp; &nbsp;-->
                                                                    <span class="badge bg-primary">Encounter: {{value.data.encounter_id}}</span>&nbsp; &nbsp; 
                                                                </td>
                                                            </tr>
                                                            <tr ng-repeat-end ng-show="expanded" ng-repeat="(patconsultant_key, patConsultant) in value.all">
                                                                <td>&nbsp;</td>
                                                                <td>{{patConsultant.branch_name}}</td>
                                                                <td> {{patConsultant.consult_date| moment:'DD/MM/YYYY'}} &nbsp;
                                                                    <span class="label bg-light dk">{{patConsultant.consult_date| moment:'hh:mm A'}}</span> 
                                                                </td>
                                                                <td> {{patConsultant.consultant_name}} </td>
                                                                <td valign="middle">
                                                                    <!--                                                                    <div tooltip-placement="left" data-tooltip-html-unsafe="{{patConsultant.concatenate_notes ? patConsultant.full_notes : ''}}"> <span ng-bind-html="patConsultant.short_notes"></span> </div>-->
                                                                    <span ng-bind-html="patConsultant.full_notes"></span>
                                                                </td>
                                                                <td>{{patConsultant.created_by_name}}</td>
                                                                <td>
                                                                    <div ng-if="patConsultant.tenant_id != null && patConsultant.encounter_status">
                                                                        <a ng-show="patConsultant.tenant_id == app.logged_tenant_id" data-button="patient.consultantUpdate({id: '{{$state.params.id}}', vital_id: '{{patConsultant.pat_consult_id}}'})" check-access-custom class="label bg-info dk" title="Edit" ng-click="updateconsulRow(patConsultant.pat_consult_id)">
                                                                            <i class="fa fa-pencil"></i>
                                                                        </a>&nbsp;&nbsp;&nbsp;
                                                                        <a ng-show="patConsultant.tenant_id == app.logged_tenant_id" title="Delete" ng-click="removeconsultantRow(patConsultant.pat_consult_id)" class="label bg-dark dk">
                                                                            <i class="fa fa-trash"></i>
                                                                        </a>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        </tbody>

                                                        <tbody ng-show="isLoading">
                                                            <tr>
                                                                <td colspan="5" class="text-center"><i class="fa fa-spin fa-refresh"></i></td>
                                                            </tr>
                                                        </tbody>

                                                        <tfoot>
                                                            <tr>
                                                                <td colspan="5" class="text-center">
                                                                    <div st-pagination="" st-items-by-page="itemsByPage" st-displayed-pages="7"></div>
                                                                </td>
                                                            </tr>
                                                        </tfoot>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-12" ng-show="isLoading">
                                            <div class="text-center"><i class="fa fa-spin fa-refresh"></i></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div ng-hide="true" id='printMedicaldocument'>
        <table id="medical_case_history" style="width:100%">
            <tbody>
                <tr>
                    <td colspan="3" ng-bind-html="xml | xslt:printxslt | sanitize">
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <!--Print Bill-->
    <!--    <div id="Getprintval" ng-hide="true">
            <io-barcode id="patient_barcode" code="{{patientObj.patient_global_int_code}}" type="{{ type}}" options="barcodeOptions"></io-barcode>
            <img id="weather1" src="{{IRISOrgUrl}}/img/weather1.png" width="25" height="25" alt="" />
            <img id="weather2" src="{{IRISOrgUrl}}/img/weather2.png" width="25" height="25" alt="" />
            <img id="weather3" src="{{IRISOrgUrl}}/img/weather3.png" width="25" height="25" alt="" />
            <img id="weather4" src="{{IRISOrgUrl}}/img/weather4.png" width="25" height="25" alt="" />
        </div>     -->
</div>

<script>
    $(document).ready(function () {
    //var site_url = $('[ng-controller="PrescriptionController"]').scope().IRISOrgUrl;
    $('#search-form').on('click', function (e) {
    e.stopPropagation();
    });
    $.getScript("js/slidebars.js", function (data, textStatus, jqxhr) {
    slidebar();
    });
//        prescription right navigation
    $('.expand-notes').click(function (e) {
    $('#makeit-full').toggleClass('fullscreen');
    $('.note-full').toggleClass('fullscreen');
    var div_width = '-' + $('#makeit-full').css('width');
    $('#sb-site').css('transform', 'translate(' + div_width + ')');
    $('#sb-site').css('transition', 'none');
    });
    $(".multimonthdatepicker").datepicker({
//            showOn: "button",
//            buttonImage: site_url + "/img/calendar.gif",
//            buttonText: "Select date",
    numberOfMonths: 2,
            showButtonPanel: true,
            dateFormat: 'yy-mm-dd',
            minDate: 0
    });
    });
    function slidebar() {
    $.slidebars({
    scrollLock: true
    });
    }
</script>