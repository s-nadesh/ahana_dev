<div class="bg-light lter b-b wrapper-md">
    <h1 class="m-n h3">Documents</h1>
</div>

<div class="wrapper-md document-filters" ng-controller="DocumentsController" ng-init="loadPatDocumentsList();">
    <div class="panel panel-default">
        <div class="row wrapper">
            <div class="col-sm-5">
                <div class="form-inline">
                    <!--                    <div class="input-group">
                                            <input placeholder="Filter by date" prevent-enter type="text" class="form-control" datepicker-popup="yyyy-MM-dd" ng-model="filterdate" is-open="opened" datepicker-options="dateOptions" close-text="Close" max-date="maxDate" date-disabled="disabled(date, mode)" ng-change="loadPatDocumentsList(filterdate);"/>
                                            <span class="input-group-btn">
                                                <button type="button" class="btn btn-default" ng-click="open($event)"><i class="glyphicon glyphicon-calendar"></i></button>
                                            </span>
                                        </div>-->
                    <select class="form-control search-dropdown" ng-model="day" ng-options="day.value as day.label for day in days">
                        <option value="">DD</option>
                    </select>
                    <select class="form-control search-dropdown" ng-model="month" ng-options="month.value as month.label for month in months">
                        <option value="">MM</option>
                    </select>
                    <select class="form-control search-dropdown" ng-model="year" ng-options="year.value as year.label for year in years">
                        <option value="">YYYY</option>
                    </select>
                    <button class="btn m-b-xs btn-grey"  ng-disabled=" (day && month && year) ? false : true" ng-click="loadPatDocumentsList(year + '-' + month + '-' + day)">
                        &nbsp; &nbsp; <i class="fa fa-search"></i> &nbsp; &nbsp;
                    </button>
                    <button title="Clear" ng-click="day = '';month = '';year = '';loadPatDocumentsList()" class="btn btn-dark m-b-xs">
                        <i class="fa fa-times"></i>
                    </button>

                </div>

                <div class="form-horizontal">

                </div>
            </div>

            <div class="col-sm-7   text-right"> 
                <form role="form" class="form-inline" name="createForm" novalidate>
                    <!--<label><b> Encounter # :</b></label>-->
                    <select class="selectpicker" data-live-search="true" ng-model="add_doc_encounter_id" ng-options="encounter_list.encounter_id as encounter_list.encounter_full_details for encounter_list in encounters_list" required>
                        <option value="">Select Encounter ID</option>
                    </select>
                    <!--                            <label><b> Document Type : </b></label>-->
                    <select class="form-control" name="add_document" ng-model="add_document" ng-options="document.value as document.label for document in documents" required>
                        <option value="">Document Type </option>
                    </select> 

                    <button class="btn btn-info" ng-disabled="createForm.$invalid"  ng-click="switchAddDocument()"> 
                        <i class="fa fa-plus"></i> Create Document 
                    </button>
                </form>
            </div>
        </div>

        <div class="table-responsive in-patient-table">
            <table class="table table-striped b-t b-light">
                <thead>
                    <tr>
                        <th>
                            <button class="btn btn-sm btn-default hms-plus" type="button" ng-click="ctrl.expandAll(allExpanded = !allExpanded)">
                                <i ng-if="!allExpanded" class="fa fa-plus text"></i>
                                <i ng-if="allExpanded" class="fa fa-minus text"></i>
                            </button>
                        </th>
                        <th>Document Date</th>
                        <th>Branch Name</th>
                        <th>Document Type</th>
                        <th>Document Name</th>
                        <th>Created By</th>
                        <th>Actions</th>
                    </tr>
                </thead>

                <tbody ng-show="isLoading">
                    <tr>
                        <td colspan="6" class="text-center"><i class="fa fa-spin fa-refresh"></i></td>
                    </tr>
                </tbody>

                <tbody ng-hide="isLoading">
                    <tr ng-repeat-start="(key, value) in rowCollection" ng-init="expanded = (key == 0) ? true : false;">
                        <td>
                            <button ng-click="expanded = !expanded" expand class="btn btn-sm btn-default hms-plus">
                                <i ng-if="!expanded" class="fa fa-plus text"></i>
                                <i ng-if="expanded" class="fa fa-minus text"></i>
                            </button>
                        </td>
                        <td colspan="6">
                            <b>
<!--                                <span class="badge bg-primary">Branch: {{value.tenant_name}}</span>&nbsp; &nbsp;-->
                                <span class="badge bg-black">Encounter: {{value.encounter_id}}</span>&nbsp; &nbsp; 
                            </b>
                        </td>
                    </tr>
                    <tr ng-repeat-end ng-show="expanded" ng-repeat="(doc_key, doc) in value.all">
                        <td align="center" valign="middle"></td>
                        <td valign="middle"> {{doc.date_time| moment:'DD/MM/YYYY - hh:mm A'}}</td>
                        <td>{{doc.tenant_name}}</td>
                        <td valign="middle"> 
                            <span ng-if="doc.doc_type == 'CH' && doc.status == '0'">
                                <img ng-src="img/incomplete.gif" title="InComplete"  alt="InComplete" width="" height="" />
                            </span>
                            {{doc.doc_type_name}} 
                        </td>
                        <td valign="middle"> {{doc.doc_name}} </td>
                        <td valign="middle"> {{doc.created_by}} </td>
                        <td valign="middle">
                            <span ng-if="((doc.doc_type == 'CH') || (doc.doc_type == 'MCH'))">
                                <a class="label bg-dark" title="View" check-access  ui-sref="patient.viewDocument({id: '{{$state.params.id}}', doc_id: '{{doc.doc_id}}', document: '{{doc.doc_type}}'})">
                                    <i class="fa fa-eye"></i>
                                </a>
                                &nbsp;&nbsp;&nbsp;
                                <a ng-if="doc.tenant_id == app.logged_tenant_id" class="label bg-dark" title="Edit" check-access  ui-sref="patient.editDocument({id: '{{$state.params.id}}', doc_id: '{{doc.doc_id}}', document: '{{doc.doc_type}}'})">
                                    <i class="fa fa-pencil"></i>
                                </a>
                                &nbsp;&nbsp;&nbsp;
                                <button ng-if="doc.tenant_id == app.logged_tenant_id" type="button" title="Delete"  ng-click="deleteDocument(doc.doc_id, 'CH')" class="label bg-dark">
                                    <i class="fa fa-trash"></i>
                                </button>
                                &nbsp;&nbsp;&nbsp;
                                <button title="Print"  class="label bg-dark" ng-click="printCasedocument(doc.doc_id, doc.doc_type)">
                                    <i class="fa fa-print"></i>
                                </button>
                            </span>
                            <span ng-if="((doc.doc_type == 'OD') || (doc.doc_type == 'PT') || (doc.doc_type == 'PA'))">
                                <a class="label bg-dark" title="View" check-access  ui-sref="patient.viewOtherDocument({id: '{{$state.params.id}}', other_doc_id: '{{doc.doc_id}}'})">
                                    <i class="fa fa-eye"></i>
                                </a>
                                &nbsp;&nbsp;&nbsp;
                                <a class="label bg-dark" ng-if="doc.tenant_id == app.logged_tenant_id" title="Edit" check-access  ui-sref="patient.editOtherDocument({id: '{{$state.params.id}}', other_doc_id: '{{doc.doc_id}}'})">
                                    <i class="fa fa-pencil"></i>
                                </a>
                                &nbsp;&nbsp;&nbsp;
                                <button type="button" ng-if="doc.tenant_id == app.logged_tenant_id" title="Delete"  ng-click="deleteDocument(doc.doc_id, 'OD')" class="label bg-dark">
                                    <i class="fa fa-trash"></i>
                                </button>
                                &nbsp;&nbsp;&nbsp;
                                <button title="Print"  class="label bg-dark" id="print" ng-click="printOtherdocument(doc.doc_id)">
                                    <i class="fa fa-print"></i>
                                </button>
                            </span>
                            <span ng-if="doc.doc_type == 'SD'">
                                <i class="fa fa-spin fa-repeat" ng-if="displayspin == doc.doc_id"></i>
                                <script type="text/ng-template" id="ScanDocumentModalContent.html">
                                    <div ng-include="'tpl/modal_form/modal.scan_document.html'"></div>
                                </script>
                                <button type="button" class="label bg-dark" ng-click="openModel('lg', 'ScandocumentModalInstanceCtrl', 'ScanDocumentModalContent.html', '', doc.doc_id, doc.doc_name, doc.encounter_id, doc.date_time)">
                                    <i class="fa fa-eye"></i>
                                </button>
                                &nbsp;&nbsp;&nbsp; 
                                <button type="button" title="Download"  ng-click="downloadDocument(doc.doc_id, doc.doc_name, doc.encounter_id, doc.date_time)" class="label bg-dark">
                                    <i class="fa fa-download"></i>
                                </button>
                                &nbsp;&nbsp;&nbsp;                        
                                <button type="button" ng-if="doc.tenant_id == app.logged_tenant_id" title="Delete"  ng-click="deleteDocument(doc.doc_id, 'SD')" class="label bg-dark">
                                    <i class="fa fa-trash"></i>
                                </button>
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div id="printThis" ng-hide="true">
                <table>
                    <tbody>
                        <tr>
                            <td colspan="3" style="padding: 20px">
                                <u><b>Patient Details:</b></u><br>
                                <b>Name : </b>{{patientObj.fullname}} <br>
                                <b>Patient ID :</b> {{patientObj.patient_global_int_code}} <br>
                                <b>Age :</b> {{patientObj.patient_age_ym}}<br>
                                <b>Branch Name :</b> {{app.org_name}} <br>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3" style="padding: 20px">
                                <b>Encounter # :</b> {{other_document.encounter_id}} <br>
                                <b>Document Name :</b> {{other_document.other_doc_name}} <br>
                                <b>Description :</b>
                                <p ng-bind-html="other_document.other_doc_content | sanitize"></p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div ng-hide="true" id='printThisElement'>
                <table id='print_medical_case' style="width:100%">
                    <tbody>
                        <tr>
                            <td colspan="3" ng-bind-html="xml | xslt:printxslt | sanitize">

                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>