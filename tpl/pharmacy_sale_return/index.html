<div class="bg-light lter b-b wrapper-md">
    <h1 class="m-n font-thin h3">Sale Return List</h1>
</div>
<div class="wrapper-md" ng-controller="SaleReturnController" ng-init="loadSaleReturnItemList()">
    <div ng-include="'tpl/blocks/alert.html'">
        {% include 'tpl/blocks/alert.html' %}
    </div>
    <div class="panel panel-default">
        <div class="panel-body">
            <div class="row">
                <div class="col-sm-8">
                    <button class="btn btn-sm btn-grey" ng-click="loadSaleReturnItemList()"> 
                        &nbsp; &nbsp; <i class="fa fa-repeat"></i> &nbsp; &nbsp; 
                    </button>
                    <input id="filter" type="text" placeholder="Search" class="form-control input-sm w-sm inline m-r" ng-model="form_filter"/>
                    <select class="form-control search-dropdown" ng-model="day" ng-options="day.value as day.label for day in days">
                        <option value="">DD</option>
                    </select>
                    <select class="form-control search-dropdown" ng-model="month" ng-options="month.value as month.label for month in months">
                        <option value="">MM</option>
                    </select>
                    <select class="form-control search-dropdown" ng-model="year" ng-options="year.value as year.label for year in years">
                        <option value="">YYYY</option>
                    </select>
                    <button class="btn btn-sm btn-grey" ng-click="loadSaleReturnItemList()">
                        &nbsp; &nbsp; <i class="fa fa-search"></i> &nbsp; &nbsp;
                    </button>
                    <button class="btn btn-sm btn-dark" title="clear filter" ng-click="form_filter = '';day = '';month = '';year = '';loadSaleReturnItemList()">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                <div class="col-sm-4">
                    <button check-access-button ng-click="$state.go('pharmacy.saleReturnCreate')" class="btn btn-sm btn-info pull-right">
                        <i class="fa fa-plus"></i> &nbsp; Add New Sale Return
                    </button>
                    <div class="dataTables_length">
                        <label>Show
                            <select id="ddlPageSize" class=" "  
                                    ng-model="pageSizeSelected"  
                                    ng-change="changePageSize()">  
                                <option value="10">10</option>  
                                <option value="25">25</option>  
                                <option value="50">50</option>
                                <option value="100">100</option>  
                            </select> entries
                        </label>
                    </div>
                </div>
            </div>
        </div>
        <img ng-hide="true" id="sale_logo" src="{{app.org_logo}}"/>
        <table st-table="displayedCollection"  st-safe-src="rowCollection" class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th style="width: 5%">
                        <button class="btn btn-sm btn-default" type="button" ng-click="ctrl.expandAll(allExpanded = !allExpanded)">
                            <i ng-if="!allExpanded" class="fa fa-plus text"></i>
                            <i ng-if="allExpanded" class="fa fa-minus text"></i>
                        </button>
                    </th>
                    <th st-sort="patient.fullname">Patient Name</th>
                    <th st-sort="bill_no">Bill No</th>
                    <th st-sort="sale_bill_no">Sale Bill No</th>
                    <th st-sort="sale_payment_type">Sale Type</th>
                    <th st-sort="sale_return_date">Sale Return Date</th>
                    <th st-sort="mobile_no">Contact No</th>
                    <th st-sort="total_item_sale_amount">Total Item Amount</th>
                    <th st-sort="total_item_discount_amount">Disc Amount</th>
                    <th st-sort="roundoff_amount">Roundoff Amount</th>
                    <th st-sort="bill_amount">Bill Amount</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody ng-if="isLoading == false">
                <tr ng-repeat-start="(key, row) in displayedCollection">
                    <td style="width: 5%">
                        <button ng-click="expanded = !expanded" expand class="btn btn-sm btn-default">
                            <i ng-if="!expanded" class="fa fa-plus text"></i>
                            <i ng-if="expanded" class="fa fa-minus text"></i>
                        </button>
                    </td>
                    <td ng-hide="true">
            <io-barcode id="{{row.patient.patient_global_int_code}}" code="{{row.patient.patient_global_int_code}}" type="CODE128B" options="barcodeOptions"></io-barcode>
            </td>
            <td>{{row.patient.fullname|| '-'}}</td>
            <td>{{row.bill_no}}</td>
            <td>{{row.sale_bill_no}}</td>
            <td>{{row.sale_payment_type}}</td>
            <td>{{row.sale_return_date| moment:'YYYY-MM-DD' || 'empty' }}</td>
            <td>{{row.mobile_no}}</td>
            <td>{{row.total_item_sale_amount}}</td>
            <td>{{row.total_item_discount_amount}}</td>
            <td>{{row.roundoff_amount}}</td>
            <td>{{row.bill_amount}}</td>
            <td>
                <a class="label bg-dark" title="Edit" check-access-custom data-button="pharmacy.saleReturnUpdate" ng-click="checkReturnsale(row.sale_ret_id)">
                    <i class="fa fa-pencil"></i>
                </a>
                <button tooltip="Print Bill"  class="label bg-primary dk" ng-click="printSaleReturn(row.sale_ret_id)">
                    <i class="fa fa-print"></i>
                </button>
            </td>
            </tr>
            <tr ng-repeat-end ng-show="expanded">
                <td></td>
                <td colspan="11">
                    <table class="table table-condensed table-bordered">
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>Batch No</th>
                                <th>Exp Date</th>
                                <th>Qty</th>
                                <th>MRP</th>
                                <th>Disc Amt</th>
                                <th>Vat Amt</th>
                                <th>Total Amt</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="(gKey, saleitem) in row.items | orderBy: saleitem">
                                <td>{{ saleitem.product.full_name}}</td>
                                <td>{{ saleitem.batch.batch_no}}</td>
                                <td>{{ saleitem.batch.expiry_date | moment:'MMM YYYY' || 'empty' }}</td>
                                <td>{{ saleitem.quantity}}</td>
                                <td>{{ saleitem.mrp}}</td>
                                <td>{{ saleitem.discount_amount}}</td>
                                <td>{{ saleitem.vat_amount}}</td>
                                <td>{{ saleitem.total_amount}}</td>
                            </tr>
                        </tbody>
                    </table>                            
                </td>
            </tr>
            </tbody>
            <tbody ng-if="isLoading == true">
                <tr>
                    <td colspan="13" class="text-center"><i class="fa fa-spin fa-refresh"></i></td>
                </tr>
            </tbody>
            <tfoot>
                <tr>  
                    <td align="center" colspan="10">  
                        <div class="pull-right">  
                            <pagination total-items="totalCount" ng-change="pageChanged()" items-per-page="pageSizeSelected" direction-links="true" ng-model="pageIndex" max-size="maxSize" class="pagination" boundary-links="true" rotate="false" num-pages="numPages"></pagination>  
                        </div>  
                    </td>  
                </tr> 
            </tfoot>
        </table>
    </div>
</div>
