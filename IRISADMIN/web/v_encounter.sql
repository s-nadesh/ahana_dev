CREATE VIEW `v_encounter` AS 
SELECT `a`.`appt_id` AS `id`,`c`.`encounter_id` AS `encounter_id`,CONCAT(`a`.`status_date`,' ',`a`.`status_time`) AS `date`,CASE `a`.`appt_status` WHEN 'B' THEN 'Booked' WHEN 'A' THEN 'Arrived' WHEN 'S' THEN 'Seen' WHEN 'C' THEN 'Cancelled' ELSE NULL END AS `type`,'\nOP' AS `details`,CONCAT(`b`.`title_code`,`b`.`name`) AS `doctor`,`c`.`patient_id` AS `patient_id`,`d`.`patient_guid` AS `patient_guid`,`c`.`encounter_type` AS `encounter_type`,`c`.`status` AS `status`,`a`.`status_date` AS `date_time`,`a`.`appt_status` AS `row_sts`,0 AS `is_swap`,`a`.`consultant_id` AS `consultant_id`,`a`.`tenant_id` AS `tenant_id`,`t`.`tenant_name` AS `tenant_name` FROM ((((`pat_appointment` `a` JOIN `co_user` `b` ON(`b`.`user_id` = `a`.`consultant_id`)) JOIN `pat_encounter` `c` ON(`c`.`encounter_id` = `a`.`encounter_id`)) JOIN `pat_patient` `d` ON(`d`.`patient_id` = `c`.`patient_id`)) JOIN `co_tenant` `t` ON(`t`.`tenant_id` = `a`.`tenant_id`)) UNION ALL SELECT `a`.`admn_id` AS `id`,`c`.`encounter_id` AS `encounter_id`,`a`.`status_date` AS `date`,CASE `a`.`admission_status` WHEN 'A' THEN 'Admission' WHEN 'D' THEN 'Administrative Discharge' WHEN 'CD' THEN 'Clinical Discharge' WHEN 'TR' THEN 'Transfer (Room)' WHEN 'TD' THEN 'Transfer (Doctor)' WHEN 'C' THEN 'Cancelled' WHEN 'AC' THEN 'Admission Cancelled' ELSE NULL END AS `type`,CONCAT('IP: ',`d`.`floor_name`,' > ',`e`.`ward_name`,' > ',`f`.`bed_name`,'  (',`g`.`room_type_name`,')') AS `details`,CONCAT(`b`.`title_code`,`b`.`name`) AS `doctor`,`c`.`patient_id` AS `patient_id`,`h`.`patient_guid` AS `patient_guid`,`c`.`encounter_type` AS `encounter_type`,`c`.`status` AS `status`,`a`.`status_date` AS `date_time`,`a`.`admission_status` AS `row_sts`,`a`.`is_swap` AS `is_swap`,`a`.`consultant_id` AS `consultant_id`,`a`.`tenant_id` AS `tenant_id`,`t`.`tenant_name` AS `tenant_name` FROM ((((((((`pat_admission` `a` JOIN `co_user` `b` ON(`b`.`user_id` = `a`.`consultant_id`)) JOIN `pat_encounter` `c` ON(`c`.`encounter_id` = `a`.`encounter_id`)) LEFT JOIN `co_floor` `d` ON(`d`.`floor_id` = `a`.`floor_id`)) LEFT JOIN `co_ward` `e` ON(`e`.`ward_id` = `a`.`ward_id`)) LEFT JOIN `co_room` `f` ON(`f`.`room_id` = `a`.`room_id`)) LEFT JOIN `co_room_type` `g` ON(`g`.`room_type_id` = `a`.`room_type_id`)) JOIN `pat_patient` `h` ON(`h`.`patient_id` = `c`.`patient_id`)) JOIN `co_tenant` `t` ON(`t`.`tenant_id` = `a`.`tenant_id`)) WHERE `a`.`status` = '1' ORDER BY `encounter_id` DESC,`date_time`